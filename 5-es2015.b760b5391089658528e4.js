(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"3UX2":function(t,e,n){"use strict";n.r(e),n.d(e,"WkdurchfuehrungModule",(function(){return ve}));var a=n("ofXK"),i=n("3Pt+"),s=n("tyNb"),c=n("FpXt"),r=n("mrSG"),l=n("PEb7"),o=n("tY1a");const h={moduleTranslationKey:"WKDURCHFUEHRUNG",pageTitleTranslationKey:"WKDURCHFUEHRUNG.WKDURCHFUEHRUNG.TITLE",navigationCardsConfig:{navigationCards:[]}},u={columns:[{translationKey:"WKDURCHFUEHRUNG.WETTKAMPF.TABLE.CDAY",propertyName:"wettkampfTag",width:20},{translationKey:"WKDURCHFUEHRUNG.WETTKAMPF.TABLE.DATE",propertyName:"wettkampfDatum",width:15},{translationKey:"WKDURCHFUEHRUNG.WETTKAMPF.TABLE.TIME",propertyName:"wettkampfBeginn",width:15},{translationKey:"WKDURCHFUEHRUNG.WETTKAMPF.TABLE.PLACE",propertyName:"wettkampfOrtsname",width:40}],actions:{actionTypes:[o.a.VIEW,o.a.MAP],width:6}},d={columns:[{translationKey:"WKDURCHFUEHRUNG.MATCH.TABLE.NUMMER",propertyName:"nr",width:5},{translationKey:"WKDURCHFUEHRUNG.MATCH.TABLE.SCHEIBE",propertyName:"scheibenNummer",width:5},{translationKey:"WKDURCHFUEHRUNG.MATCH.TABLE.MANNSCHAFT",propertyName:"mannschaftName",width:20},{translationKey:"WKDURCHFUEHRUNG.MATCH.TABLE.BEGEGNUNG",propertyName:"begegnung",width:5},{translationKey:"WKDURCHFUEHRUNG.MATCH.TABLE.MATCHPUNKTE",propertyName:"matchpunkte",type:5,currentSortOrder:1,width:5},{translationKey:"WKDURCHFUEHRUNG.MATCH.TABLE.SATZPUNKTE",propertyName:"satzpunkte",width:5}],actions:{actionTypes:[o.a.EDIT],width:6}};var b=n("YfBl"),f=n("S/GV"),m=n("nr0C"),p=n("sQ0O"),g=n("BMmu"),S=n("4ipa"),E=n("X628");class C{constructor(t,e,n,a,i,s,c,r,l,o,h,u,d,b,f,m,p){this.id=t||null,this.mannschaftId=e||null,this.mannschaftName=n||"Mannschaft 1",this.wettkampfId=a||null,this.nr=i||null,this.begegnung=s||null,this.scheibenNummer=c||null,this.matchpunkte=r,this.satzpunkte=l,this.strafPunkteSatz1=o||0,this.strafPunkteSatz2=h||0,this.strafPunkteSatz3=u||0,this.strafPunkteSatz4=d||0,this.strafPunkteSatz5=b||0,this.passen=f||[],this.wettkampfTyp=p,this.wettkampfTag=m}static copyFrom(t={}){const e=new C;return e.id=t.id>=0?t.id:null,e.version=t.version>=0?t.version:null,e.mannschaftId=t.mannschaftId>=0?t.mannschaftId:null,e.mannschaftName=t.mannschaftName||"",e.wettkampfId=t.wettkampfId>=0?t.wettkampfId:null,e.wettkampfTag=t.wettkampfTag>=0?t.wettkampfTag:null,e.wettkampfTyp=t.wettkampfTyp||"",e.nr=t.nr>=0?t.nr:null,e.begegnung=t.begegnung>=0?t.begegnung:null,e.scheibenNummer=t.scheibenNummer>=0?t.scheibenNummer:null,e.matchpunkte=t.matchpunkte>=0?t.matchpunkte:null,e.satzpunkte=t.satzpunkte>=0?t.satzpunkte:null,e.strafPunkteSatz1=t.strafPunkteSatz1>=0?t.strafPunkteSatz1:null,e.strafPunkteSatz2=t.strafPunkteSatz2>=0?t.strafPunkteSatz2:null,e.strafPunkteSatz3=t.strafPunkteSatz3>=0?t.strafPunkteSatz3:null,e.strafPunkteSatz4=t.strafPunkteSatz4>=0?t.strafPunkteSatz4:null,e.strafPunkteSatz5=t.strafPunkteSatz5>=0?t.strafPunkteSatz5:null,Object(E.a)(t.passen)?e.passen=null:(e.passen=new Array,t.passen.forEach(t=>{e.passen.push(t)})),e}}class T{constructor(t,e,n,a,i,s,c,r,l,o,h,u,d,b){this.id=t||null,this.mannschaftId=e||null,this.mannschaftName=n||"Mannschaft 1",this.wettkampfId=a||null,this.nr=i,this.begegnung=s,this.scheibenNummer=c||null,this.sumSatz=r||[5],this.matchpunkte=l,this.satzpunkte=o,this.fehlerpunkte=h||[],this.schuetzen=u||[],this.wettkampfTyp=b,this.wettkampfTag=d}}class P{constructor(t,e,n,a,i,s,c,r,l){this.id=t||null,this.matchId=e||null,this.mannschaftId=n||null,this.wettkampfId=a||null,this.matchNr=i||null,this.lfdNr=s||null,this.dsbMitgliedId=c||null,this.ringzahl=r||[],this.rueckennummer=l||null}}class U{constructor(t,e,n,a,i,s,c,r,l,o,h,u,d,b){this.id=t||null,this.matchId=e||null,this.mannschaftId=n||null,this.wettkampfId=a||null,this.matchNr=i||null,this.lfdNr=s||null,this.dsbMitgliedId=c||null,this.ringzahlPfeil1=r||null,this.ringzahlPfeil2=l||null,this.ringzahlPfeil3=o||null,this.ringzahlPfeil4=h||null,this.ringzahlPfeil5=u||null,this.ringzahlPfeil6=d||null,this.rueckennummer=b||null}}class N{static passeToDO(t){return new U(t.id,t.matchId,t.mannschaftId,t.wettkampfId,t.matchNr,t.lfdNr,t.dsbMitgliedId,t.ringzahl[0],t.ringzahl[1],t.ringzahl[2],t.ringzahl[3],t.ringzahl[4],t.ringzahl[5],t.rueckennummer)}static passeToDTO(t){return new P(t.id,t.matchId,t.mannschaftId,t.wettkampfId,t.matchNr,t.lfdNr,t.dsbMitgliedId,[t.ringzahlPfeil1,t.ringzahlPfeil2,t.ringzahlPfeil3,t.ringzahlPfeil4,t.ringzahlPfeil5,t.ringzahlPfeil6],t.rueckennummer)}}function I(t){const e=[];return t.forEach(t=>e.push(function(t){return C.copyFrom(t)}(t))),e}class z{static matchToDO(t){const e=[];let n=[];if(t.passen.length>0){const a=new Map;e[0]=[],e[1]=[],e[2]=[],n=[0,0,0,0,0];for(const e of t.passen){const t=N.passeToDO(e);if(a.has(e.rueckennummer))a.get(e.rueckennummer).push(t);else{const n=[];n.push(t),a.set(e.rueckennummer,n)}}console.log("schuetzenPasseMap",a);let i=0;a.forEach((t,n)=>{e[i]=t,i++}),console.log("schuetzen",e);for(let t=0;t<e[0].length;t++){if(e[0].length>5)for(let t=e[0].length;t>5;t--)e[0].pop();for(const a of e)t<5&&(n[t]+=a[t].ringzahlPfeil1+a[t].ringzahlPfeil2)}for(let n=0;n<3;n++){const a=e[n].length;let i=a;for(let s=0;s<5-a;s++)e[n].push(new U(null,t.id,t.mannschaftId,t.wettkampfId,t.nr,i+1)),++i;e[n]=e[n].sort((t,e)=>t.lfdNr-e.lfdNr)}}return new T(t.id,t.mannschaftId,t.mannschaftName,t.wettkampfId,t.nr,t.begegnung,t.scheibenNummer,n,t.matchpunkte,t.satzpunkte,[t.strafPunkteSatz1,t.strafPunkteSatz2,t.strafPunkteSatz3,t.strafPunkteSatz4,t.strafPunkteSatz5],e,t.wettkampfTag,t.wettkampfTyp)}static matchToDTO(t){const e=[];for(const n of t.schuetzen)for(const t of n)t.rueckennummer=n[0].rueckennummer,e.push(N.passeToDTO(t));return new C(t.id,t.mannschaftId,t.mannschaftName,t.wettkampfId,t.nr,t.begegnung,t.scheibenNummer,t.matchpunkte,t.satzpunkte,t.fehlerpunkte[0],t.fehlerpunkte[1],t.fehlerpunkte[2],t.fehlerpunkte[3],t.fehlerpunkte[4],e,t.wettkampfTag,t.wettkampfTyp)}}var R=n("NJqk");class k{static copyFrom(t={}){var e;const n=new k;return n.id=t.id||null,n.version=null!==(e=t.version)&&void 0!==e?e:1,n.wettkampfId=t.wettkampfId>=0?t.wettkampfId:null,n.matchNr=t.matchNr>=0?t.matchNr:null,n.matchScheibennummer=t.matchScheibennummer>=0?t.matchScheibennummer:null,n.matchpkt=t.matchpkt>=0?t.matchpkt:null,n.satzpunkte=t.satzpunkte>=0?t.satzpunkte:null,n.mannschaftId=t.mannschaftId>=0?t.mannschaftId:null,n.mannschaftName=t.mannschaftName||null,n.nameGegner=t.nameGegner||null,n.scheibennummerGegner=t.scheibennummerGegner>=0?t.scheibennummerGegner:null,n.matchIdGegner=t.matchIdGegner>=0?t.matchIdGegner:null,n.naechsteMatchId=t.naechsteMatchId>=0?t.naechsteMatchId:null,n.naechsteNaechsteMatchNrMatchId=t.naechsteNaechsteMatchNrMatchId>=0?t.naechsteNaechsteMatchNrMatchId:null,n.strafpunkteSatz1=t.strafpunkteSatz1>=0?t.strafpunkteSatz1:null,n.strafpunkteSatz2=t.strafpunkteSatz2>=0?t.strafpunkteSatz2:null,n.strafpunkteSatz3=t.strafpunkteSatz3>=0?t.strafpunkteSatz3:null,n.strafpunkteSatz4=t.strafpunkteSatz4>=0?t.strafpunkteSatz4:null,n.strafpunkteSatz5=t.strafpunkteSatz5>=0?t.strafpunkteSatz5:null,n}}function v(t,e){const n=[];return t.forEach(t=>n.push(O(t,e))),n}function O(t,e){const n=[];e.forEach(e=>{e.matchId===t.matchId&&n.push(e)});const a=Math.ceil(t.matchScheibennummer/2);return{id:t.matchId,version:t.matchVersion,mannschaftId:t.mannschaftId,mannschaftName:t.mannschaftName,nr:t.matchNr,begegnung:a,matchpunkte:t.matchpkt,scheibenNummer:t.matchScheibennummer,passen:n,satzpunkte:t.satzpunkte,strafPunkteSatz1:t.strafpunkteSatz1,strafPunkteSatz2:t.strafpunkteSatz2,strafPunkteSatz3:t.strafpunkteSatz3,strafPunkteSatz4:t.strafpunkteSatz4,strafPunkteSatz5:t.strafpunkteSatz5,wettkampfId:t.wettkampfId,wettkampfTag:null,wettkampfTyp:""}}function M(t){const e=[];return t.forEach(t=>e.push(function(t){return{offlineVersion:1,matchId:(e=k.copyFrom(t)).id,matchVersion:e.version,mannschaftId:e.mannschaftId,mannschaftName:e.mannschaftName,matchIdGegner:e.matchIdGegner,matchNr:e.matchNr,matchScheibennummer:e.matchScheibennummer,matchpkt:e.matchpkt,satzpunkte:e.satzpunkte,naechsteMatchId:e.naechsteMatchId,naechsteNaechsteMatchNrMatchId:e.naechsteNaechsteMatchNrMatchId,nameGegner:e.nameGegner,scheibennummerGegner:e.scheibennummerGegner,strafpunkteSatz1:e.strafpunkteSatz1,strafpunkteSatz2:e.strafpunkteSatz2,strafpunkteSatz3:e.strafpunkteSatz3,strafpunkteSatz4:e.strafpunkteSatz4,strafpunkteSatz5:e.strafpunkteSatz5,wettkampfId:e.wettkampfId};var e}(t))),e}var w=n("fXoL");let H=(()=>{class t extends b.DataProviderService{constructor(t,e){super(),this.restClient=t,this.onOfflineService=e,this.serviceSubUrl="v1/match"}getmatchoffline(t){return new Promise((e,n)=>{S.a.matchTabelle.where("matchNr").equals(t).toArray().then(t=>{e({result:b.RequestResult.SUCCESS,payload:v(t,[])})},()=>{n({result:b.RequestResult.FAILURE})})})}get(t){return new Promise((e,n)=>{this.restClient.GET((new b.UriBuilder).fromPath(this.getUrl()).path(t).build()).then(t=>{const n=z.matchToDO(t);e({result:b.RequestResult.SUCCESS,payload:n})},t=>{n(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})})})}create(t){const e=z.matchToDTO(t);return new Promise((t,n)=>{this.restClient.POST(this.getUrl(),e).then(e=>{const n=z.matchToDO(e);t({result:b.RequestResult.SUCCESS,payload:n})},t=>{n(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})})})}update(t){const e=z.matchToDTO(t);return new Promise((t,n)=>{this.restClient.PUT(this.getUrl(),e).then(e=>{const n=z.matchToDO(e);t({result:b.RequestResult.SUCCESS,payload:n})},t=>{n(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})})})}findAllWettkampfMatchesAndNamesById(t){return this.onOfflineService.isOffline()?(console.log("Choosing offline way for findallmatches by wettkampfid "+t),new Promise((e,n)=>{S.a.matchTabelle.where("wettkampfId").equals(t).toArray().then(t=>{e({result:b.RequestResult.SUCCESS,payload:v(t,[])})},()=>{n({result:b.RequestResult.FAILURE})})})):new Promise((e,n)=>{this.restClient.GET((new b.UriBuilder).fromPath(this.getUrl()).path("findByWettkampfId/wettkampfid="+t).build()).then(t=>{e({result:b.RequestResult.SUCCESS,payload:I(t)})},t=>{n(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})})})}next(t){return new Promise((e,n)=>{this.restClient.GET((new b.UriBuilder).fromPath(this.getUrl()).path(t).path("next").build()).then(t=>{e({result:b.RequestResult.SUCCESS,payload:t})},t=>{n(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})})})}pair(t){return this.onOfflineService.isOffline()?new Promise((e,n)=>{S.a.matchTabelle.get(t).then(t=>{e({result:b.RequestResult.SUCCESS,payload:[Math.min(t.matchId,t.matchIdGegner),Math.max(t.matchId,t.matchIdGegner)]})},()=>{n({result:b.RequestResult.FAILURE})})}):new Promise((e,n)=>{this.restClient.GET((new b.UriBuilder).fromPath(this.getUrl()).path(t).path("pair").build()).then(t=>{e({result:b.RequestResult.SUCCESS,payload:t})},t=>{n(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})})})}pairToFollow(t){return Object(r.a)(this,void 0,void 0,(function*(){if(this.onOfflineService.isOffline()){let e;yield this.pair(t).then(t=>e=t.payload).catch(t=>console.error(t));let n=0;return yield S.a.matchTabelle.get(e[1]).then(e=>{n=e.naechsteMatchId<=t?e.naechsteNaechsteMatchNrMatchId:e.naechsteMatchId}),this.pair(n)}return new Promise((e,n)=>{this.restClient.GET((new b.UriBuilder).fromPath(this.getUrl()).path(t).path("pairToFollow").build()).then(t=>{e({result:b.RequestResult.SUCCESS,payload:t})},t=>{n(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})})})}))}previousPair(t){return Object(r.a)(this,void 0,void 0,(function*(){if(this.onOfflineService.isOffline()){let e=[];yield this.pair(t).then(t=>e=t.payload).catch(t=>console.error(t));let n=null;return yield S.a.matchTabelle.where("naechsteMatchId").equals(e[0]).first().then(t=>n=t.matchId).catch(t=>console.error(t)),null===n&&(yield S.a.matchTabelle.where("naechsteNaechsteMatchNrMatchId").equals(e[0]).last().then(t=>n=t.matchId).catch(t=>console.error(t))),n||(n=t),this.pair(n)}return new Promise((e,n)=>{this.restClient.GET((new b.UriBuilder).fromPath(this.getUrl()).path(t).path("previousPair").build()).then(t=>{e({result:b.RequestResult.SUCCESS,payload:t})},t=>{n(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})})})}))}}return t.\u0275fac=function(e){return new(e||t)(w.Ub(b.RestClient),w.Ub(R.i))},t.\u0275prov=w.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var y=n("9VTN"),A=n("gQPg"),D=n("AytR"),F=n("hEMT"),L=n("TcZ0");class Q{}class G{static copyFrom(t={}){const e=new G;return e.veranstaltungId=t.veranstaltungId,e.veranstaltungName=t.veranstaltungName,e.wettkampfId=t.wettkampfId,e.wettkampfTag=t.wettkampfTag,e.mannschaftId=t.mannschaftId,e.mannschaftName=t.mannschaftName,e.matchpkt=t.matchpkt,e.matchpktGegen=t.matchpktGegen,e.satzpkt=t.satzpkt,e.satzpktGegen=t.satzpktGegen,e.satzpktDifferenz=t.satzpktDifferenz,e.sortierung=t.sortierung,e.tabellenplatz=t.tabellenplatz,e}}function _(t){const e=[];return t.forEach(t=>e.push(function(t){return{veranstaltungId:(e=G.copyFrom(t)).veranstaltungId,veranstaltungName:e.veranstaltungName,wettkampfId:e.wettkampfId,wettkampfTag:e.wettkampfTag,mannschaftId:e.mannschaftId,mannschaftName:e.mannschaftName,matchpkt:e.matchpkt,matchpktGegen:e.matchpktGegen,satzpkt:e.satzpkt,satzpktGegen:e.satzpktGegen,satzpktDifferenz:e.satzpktDifferenz,sortierung:e.sortierung,tabellenplatz:e.tabellenplatz};var e}(t))),e}var W=n("KDU1"),K=n("BcWp"),Z=n("L93z"),B=n("z6cu"),x=n("dLXM"),V=n("XcAF"),j=n("BGab"),q=n("ykT2"),Y=n("FlTZ"),X=n("QOHg"),$=n("ny2l");let J=(()=>{class t extends b.DataProviderService{constructor(t,e,n,a,i){super(),this.restClient=t,this.mannschaftDataProvider=e,this.vereinDataProvider=n,this.veranstaltungDataProvider=a,this.dsbMitgliedDataProvider=i,this.serviceSubUrl="v1/sync"}loadLigatabelleVeranstaltungOffline(t){return new Promise((e,n)=>{this.loadLigatabelleVeranstaltung(t).then(t=>{this.handleLoadLigatabelleVeranstaltungSuccess(t),e()}).catch(t=>{console.log("error loading offline ligatabelle"),n()})})}loadMatchOffline(t){return new Promise((e,n)=>{this.loadMatch(t).then(t=>{this.handleLoadMatchTabelleSuccess(t.payload),e()}).catch(t=>{console.log("error loading offline match"),n()})})}handleLoadMatchTabelleSuccess(t){return Object(r.a)(this,void 0,void 0,(function*(){yield S.a.passeTabelle.toArray().then(e=>{const n=this.getOfflineMatchPunkte(t,e);S.a.matchTabelle.bulkPut(n,n.map(t=>t.matchId)).then(t=>{console.log("offline match added to offlinedb",t)}).catch(t=>{console.log("error adding offline match to offlinedb",t)})})}))}getOfflineMatchPunkte(t,e){const n=[];return t.forEach(a=>{if(n.find(t=>t.matchId===a.matchId))return;const i=t.find(t=>t.matchId===a.matchIdGegner),s=this.getOfflineMatchSatzSumme(a.matchId,e),c=this.getOfflineMatchSatzSumme(i.matchId,e);s[0]>0&&(a.satzpunkte=0),c[0]>0&&(i.satzpunkte=0);for(let t=0;t<5;t++)s[t]>c[t]?a.satzpunkte+=2:s[t]<c[t]?i.satzpunkte+=2:s[t]===c[t]&&0!==s[t]&&(a.satzpunkte+=1,i.satzpunkte+=1);a.satzpunkte>=6?(a.matchpkt=2,i.matchpkt=0):i.satzpunkte>=6?(i.matchpkt=2,a.matchpkt=0):a.satzpunkte===i.satzpunkte&&a.satzpunkte>=5?(a.matchpkt=1,i.matchpkt=1):a.satzpunkte>0&&i.satzpunkte>0&&(a.matchpkt=0,i.matchpkt=0),n.push(a,i)}),n}getOfflineMatchSatzSumme(t,e){const n=[0,0,0,0,0];return e.forEach(e=>{e.matchID===t&&(n[e.lfdNr-1]+=e.ringzahlPfeil1+e.ringzahlPfeil2)}),n}loadPasseOffline(t){return Object(r.a)(this,void 0,void 0,(function*(){let e=[];return yield S.a.mannschaftsmitgliedTabelle.toArray().then(t=>e=t).catch(t=>console.error(t)),new Promise((n,a)=>{this.loadPasse(t).then(t=>{const i=t.payload.map(t=>(t.rueckennummer=e.find(e=>e.dsbMitgliedId===t.dsbMitgliedId).rueckennummer,t));S.a.passeTabelle.bulkPut(i,i.map(t=>t.id)).then(t=>{console.log("offline passe added to offlinedb",t),n()}).catch(t=>{console.error("error adding offline passe to offlinedb",t),a()})}).catch(t=>{console.error("error loading offline passe payload:",t.payload),a()})})}))}loadWettkampfOffline(t){return Object(r.a)(this,void 0,void 0,(function*(){return new Promise((e,n)=>{this.loadWettkampf(t).then(t=>{console.log("offline wettkampf from mapper",t),S.a.wettkampfTabelle.add(t.payload,t.payload.id).then(t=>{console.log("offline wettkampf added to offlinedb",t),e()}).catch(t=>{console.error("error adding offline wettkampf to offlinedb",t),n()})}).catch(t=>{console.error("error loading offline wettkampf payload:",t.payload),n()})})}))}loadMannschaftOffline(t){return new Promise((e,n)=>{this.loadMannschaft(t).then(t=>{S.a.mannschaftTabelle.bulkPut(t.payload,t.payload.map(t=>t.id)).then(t=>{console.log("offline mannschaft added to offlinedb",t),e()}).catch(t=>{console.error("error adding offline mannschaft to offlinedb",t),n()})}).catch(t=>{console.error("error loading offline mannschaft payload:",t.payload),n()})})}loadMannschaftsmitgliedOffline(t){return new Promise((e,n)=>{this.loadMannschaftsmitglied(t).then(t=>{S.a.mannschaftsmitgliedTabelle.bulkPut(t.payload,t.payload.map(t=>t.id)).then(t=>{console.log("offline mannschaftsmitglied added to offlinedb",t),e()}).catch(t=>{console.error("error adding offline mannschaftsmitglied to offlinedb",t),n()})}).catch(t=>{console.error("error loading offline mannschaftsmitglied payload:",t.payload),n()})})}loadDsbMitgliedOffline(){return new Promise((t,e)=>{this.loadDsbMitglieder().then(n=>{S.a.dsbMitgliedTabelle.bulkPut(n.payload,n.payload.map(t=>t.id)).then(e=>{console.log("offline dsb mitglied added to offlinedb",e),t()}).catch(t=>{console.error("error adding offline dsb mitglied to offlinedb",t),e()})}).catch(t=>{console.error("error loading offline dsb mitglied payload:",t.payload),e()})})}loadVereineOffline(){return new Promise((t,e)=>{this.loadVereine().then(n=>{S.a.vereinTabelle.bulkPut(n.payload,n.payload.map(t=>t.id)).then(e=>{console.log("offline vereine added to offlinedb",e),t()}).catch(t=>{console.error("error adding offline vereine to offlinedb",t),e()})}).catch(t=>{console.error("error loading offline verein payload:",t.payload),e()})})}loadManschaftenOffline(){return new Promise((t,e)=>{this.loadMannschaften().then(n=>{S.a.mannschaftTabelle.bulkPut(n.payload,n.payload.map(t=>t.id)).then(e=>{console.log("offline mannschaften added to offlinedb",e),t()}).catch(t=>{console.error("error adding offline mannschaften to offlinedb",t),e()})}).catch(t=>{console.error("error loading offline manschaften payload:",t.payload),e()})})}loadVeranstaltungOffline(t){return new Promise((e,n)=>{this.loadVeranstaltung(t).then(t=>{S.a.veranstaltungTabelle.bulkPut(t.payload,t.payload.map(t=>t.id)).then(t=>{console.log("offline veranstaltung added to offlinedb",t),e()}).catch(t=>{console.error("error adding offline veranstaltung to offlinedb",t),n()})}).catch(t=>{console.error("error loading offline veranstaltung payload:",t.payload),n()})})}loadMatch(t){const e=(new b.UriBuilder).fromPath(this.getUrl()).path("match/"+t).build();return new Promise((t,n)=>{this.restClient.GET(e).then(e=>{t({result:b.RequestResult.SUCCESS,payload:M(e)})},t=>this.handleErrorResponse(t,n))})}loadVereine(){return new Promise((t,e)=>{this.vereinDataProvider.findAll().then(e=>{t({result:b.RequestResult.SUCCESS,payload:Object(X.a)(e.payload)})}).catch(t=>console.error(t))})}loadMannschaften(){return new Promise((t,e)=>{this.mannschaftDataProvider.findAll().then(e=>{t({result:b.RequestResult.SUCCESS,payload:Object(K.d)(e.payload)})}).catch(t=>console.error(t))})}loadPasse(t){const e=(new b.UriBuilder).fromPath(this.getUrl()).path("passe/"+t).build();return new Promise((t,n)=>{this.restClient.GET(e).then(e=>{t({result:b.RequestResult.SUCCESS,payload:Object(W.a)(e)})},t=>n({result:b.RequestResult.FAILURE,payload:"Fehler beim Laden der P\xe4sse"}))})}loadWettkampf(t){const e=(new b.UriBuilder).fromPath(this.getUrl()).path("wettkampf/"+t).build();return new Promise((t,n)=>{this.restClient.GET(e).then(e=>{t({result:b.RequestResult.SUCCESS,payload:Object(V.a)(e[0])})},t=>this.handleErrorResponse(t,n))})}loadMannschaft(t){return new Promise((e,n)=>{this.restClient.GET((new b.UriBuilder).fromPath(this.getUrl()).path("mannschaft="+t).build()).then(t=>{e({result:b.RequestResult.SUCCESS,payload:Object(K.a)(t)})},t=>this.handleErrorResponse(t,n))})}loadMannschaftsmitglied(t){return new Promise((e,n)=>{this.restClient.GET((new b.UriBuilder).fromPath(this.getUrl()).path("mannschaftsmitglieder/"+t).build()).then(t=>{e({result:b.RequestResult.SUCCESS,payload:Object(Z.b)(t)})},t=>this.handleErrorResponse(t,n))})}loadDsbMitglieder(){return new Promise((t,e)=>{this.dsbMitgliedDataProvider.findAll().then(e=>{t({result:b.RequestResult.SUCCESS,payload:Object(q.a)(e.payload)})}).catch(t=>console.error(t))})}loadVeranstaltung(t){return new Promise((e,n)=>{this.veranstaltungDataProvider.findById(t).then(t=>{e({result:b.RequestResult.SUCCESS,payload:[Object(x.c)(t.payload)]})}).catch(t=>console.error(t))})}loadLigatabelleVeranstaltung(t){return new Promise((e,n)=>{this.restClient.GET((new b.UriBuilder).fromPath(this.getUrl()).path("veranstaltung="+t).build()).then(t=>{e({result:b.RequestResult.SUCCESS,payload:_(t)})},t=>this.handleErrorResponse(t,n))})}handleLoadLigatabelleVeranstaltungSuccess(t){S.a.ligaTabelle.clear(),S.a.ligaTabelle.bulkAdd(t.payload).then(t=>console.log("Finished adding numbers til "+t)).catch(t=>Object(B.a)(t))}handleLoadLigatabelleVeranstaltungFailure(t){console.log("Failure")}handleErrorResponse(t,e){e(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})}createWettkampfDummyData(){return Object(r.a)(this,void 0,void 0,(function*(){const t=[];for(let e=0;e<4;e++)t.push({id:30+e,datum:"2017-12-30",ausrichter:"2",beginn:"12:5"+e,offlinetoken:"dsfgsgffddfdfhfghfhfhfgdsaljfgkjdyfgfdkljbdfjhdfsklbhndsklghdfslgjhdyfkl\xf6hdfkljghdfsjghljkglhkjdsflhkdfshjkghjkldgkhjldgkhjldkjhlg",disziplinId:0,plz:"72108",version:5,ortsinfo:null,tag:""+(e+1),ortsname:"Ofterdingen",strasse:"Brunnenstra\xdfe",wettkampftypId:1,veranstaltungId:0});S.a.wettkampfTabelle.clear(),S.a.wettkampfTabelle.bulkPut(t,t.map(t=>t.id))}))}goOnlineSync(t){return Object(r.a)(this,void 0,void 0,(function*(){return console.clear(),new Promise((e,n)=>Object(r.a)(this,void 0,void 0,(function*(){try{const e=yield S.a.wettkampfTabelle.get(t).then(t=>t.offlinetoken);let n=[];n=yield S.a.matchTabelle.where("offlineVersion").above(1).toArray();const a=yield S.a.mannschaftsmitgliedTabelle.where("offlineVersion").above(1).toArray(),i=[];for(const t of n){let e=[];e=yield S.a.passeTabelle.where("matchID").equals(t.matchId).toArray();const n=Object(W.d)(e);for(const a of n)a.matchNr=t.matchNr;i.push(O(t,n))}let s,c=[];c=Object(Z.e)(a),s={wettkampfId:t,offlineToken:e,matchesDTO:i,mannschaftsmitgliederDTO:c},console.log("Sync Payload: ",s),yield this.restClient.POST((new b.UriBuilder).fromPath(this.getUrl()).path(`wettkampf/${t}/sync`).build(),s)}catch(a){console.error(a),n(a)}e()})))}))}resetWettkampfToken(t){return Object(r.a)(this,void 0,void 0,(function*(){return new Promise((e,n)=>Object(r.a)(this,void 0,void 0,(function*(){try{yield this.restClient.GET((new b.UriBuilder).fromPath(this.getUrl()).path(`wettkampf/${t}/reset`).build()),console.log("Wettkampf Token reseted")}catch(a){console.error(a),n(a)}e()})))}))}}return t.\u0275fac=function(e){return new(e||t)(w.Ub(b.RestClient),w.Ub($.a),w.Ub(Y.a),w.Ub(m.a),w.Ub(j.a))},t.\u0275prov=w.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var tt=n("sNGV"),et=n("0IaG"),nt=n("KKVP"),at=n("cWIM");let it=(()=>{class t{constructor(t){this.dialogRef=t,this.ActionButtonColors=tt.a}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(w.Lb(et.d))},t.\u0275cmp=w.Fb({type:t,selectors:[["bla-dsb-mitglied-detail-pop-up"]],decls:4,vars:4,consts:[[1,"mat-dialog-content"],[3,"isPopUp","dialogRef"],[3,"color","iconClass","onClick"]],template:function(t,e){1&t&&(w.Qb(0,"div",0),w.Mb(1,"bla-dsb-mitglied-detail",1),w.Qb(2,"bla-actionbutton",2),w.Xb("onClick",(function(){return e.dialogRef.close()})),w.Cc(3,"Zur\xfcck"),w.Pb(),w.Pb()),2&t&&(w.zb(1),w.fc("isPopUp",!0)("dialogRef",e.dialogRef),w.zb(1),w.fc("color",e.ActionButtonColors.SECONDARY)("iconClass","arrow-left"))},directives:[nt.a,at.a],styles:["*[_ngcontent-%COMP%]{color:red}"]}),t})();var st=n("a7Kz"),ct=n("20cS"),rt=n("w90F"),lt=n("ghtv"),ot=n("hIfO"),ht=n("cHN3"),ut=n("zLSN"),dt=n("xOPY");const bt={columns:[{translationKey:"MANAGEMENT.VEREIN_DETAIL.TABLE.HEADERS.MANNSCHAFTSNAME",propertyName:"name",width:20}],actions:{actionTypes:[o.a.ADD],width:6},deletePermission:[R.j.CAN_DELETE_STAMMDATEN],editPermission:[R.j.CAN_MODIFY_MY_VEREIN]};var ft=n("Fado");let mt=(()=>{class t{constructor(t,e){this.dialogRef=t,this.data=e}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(w.Lb(et.d),w.Lb(et.a))},t.\u0275cmp=w.Fb({type:t,selectors:[["bla-schuetzen-pop-up"]],decls:1,vars:3,consts:[[3,"isPopUp","dialogRef","selectedMannschaftId"]],template:function(t,e){1&t&&w.Mb(0,"bla-schuetzen",0),2&t&&w.fc("isPopUp",!0)("dialogRef",e.dialogRef)("selectedMannschaftId",e.data.selectedMannschaftId)},directives:[ft.a],styles:[""]}),t})(),pt=(()=>{class t{constructor(t,e,n){this.mannschaftsdataprovider=t,this.veranstaltungsProvider=e,this.dialog=n,this.config_table=bt,this.loading=!1}ngOnInit(){}ngOnChanges(t){this.veranstaltungsId||0===this.veranstaltungsId?(this.loading=!0,this.mannschaftsdataprovider.findAllByVeranstaltungsId(this.veranstaltungsId).then(t=>{t=this.addTableAttributes(t),this.rows=[],this.rows=Object(l.toTableRows)(t.payload),this.loading=!1}).catch(()=>{console.log("Error Loading Mannschaften"),this.loading=!1})):this.rows=[]}addTableAttributes(t){let e;return t.payload.forEach(t=>{e=t.name.substring(0,t.name.length-1),t.name=e+" "+t.nummer+".Mannschaft"}),t}onAdd(t){t.id>=0&&(this.selectedMannschaft=t.id.toString(),this.dialog.open(mt,{data:{selectedMannschaftId:this.selectedMannschaft}}))}}return t.\u0275fac=function(e){return new(e||t)(w.Lb($.a),w.Lb(m.a),w.Lb(et.b))},t.\u0275cmp=w.Fb({type:t,selectors:[["bla-teilnemende-manschaften-tabelle"]],inputs:{veranstaltungsId:"veranstaltungsId"},features:[w.xb],decls:4,vars:3,consts:[[3,"config","rows","loading","onAddEntry"]],template:function(t,e){1&t&&(w.Qb(0,"h2"),w.Cc(1,"Teilnehmende Mannschaften"),w.Pb(),w.Qb(2,"div"),w.Qb(3,"bla-data-table",0),w.Xb("onAddEntry",(function(t){return e.onAdd(t)})),w.Pb(),w.Pb()),2&t&&(w.zb(3),w.fc("config",e.config_table)("rows",e.rows)("loading",e.loading))},directives:[dt.a],styles:[""]}),t})();var gt=n("WBa3"),St=n("sYmb");function Et(t,e){if(1&t){const t=w.Rb();w.Qb(0,"div",29),w.Qb(1,"bla-actionbutton",30),w.Xb("click",(function(){return w.pc(t),w.Zb().onButtonTabletClick()})),w.Cc(2),w.ac(3,"translate"),w.Pb(),w.Pb()}if(2&t){const t=w.Zb();w.zb(1),w.fc("color",t.ActionButtonColors.PRIMARY)("iconClass","table")("disabled",t.isDisabled()),w.zb(1),w.Ec("",w.bc(3,4,"WKDURCHFUEHRUNG.BUTTON.TABLE_SETUP")," ")}}function Ct(t,e){if(1&t){const t=w.Rb();w.Qb(0,"div"),w.Qb(1,"bla-actionbutton",30),w.Xb("click",(function(){return w.pc(t),w.Zb().onButtonTabletClick()})),w.Cc(2),w.ac(3,"translate"),w.Pb(),w.Pb()}if(2&t){const t=w.Zb();w.zb(1),w.fc("color",t.ActionButtonColors.PRIMARY)("iconClass","table")("disabled",!0),w.zb(1),w.Ec("",w.bc(3,4,"WKDURCHFUEHRUNG.BUTTON.TABLE_SETUP")," ")}}function Tt(t,e){if(1&t){const t=w.Rb();w.Qb(0,"div",31),w.Qb(1,"bla-actionbutton",32),w.Xb("click",(function(){return w.pc(t),w.Zb().onButtonGoOfflineClick()})),w.Cc(2),w.ac(3,"translate"),w.Pb(),w.Pb()}if(2&t){const t=w.Zb();w.zb(1),w.fc("color",t.ActionButtonColors.DANGER)("iconClass","power-off")("disabled",t.isDisabled()),w.zb(1),w.Ec("",w.bc(3,4,"WKDURCHFUEHRUNG.BUTTON.OFFLINE_GEHEN")," ")}}function Pt(t,e){if(1&t){const t=w.Rb();w.Qb(0,"div"),w.Qb(1,"bla-actionbutton",30),w.Xb("click",(function(){return w.pc(t),w.Zb().onButtonGoOfflineClick()})),w.Cc(2),w.ac(3,"translate"),w.Pb(),w.Pb()}if(2&t){const t=w.Zb();w.zb(1),w.fc("color",t.ActionButtonColors.SUCCESS)("iconClass","cloud")("disabled",t.isDisabled()),w.zb(1),w.Ec("",w.bc(3,4,"WKDURCHFUEHRUNG.BUTTON.ONLINE_GEHEN")," ")}}function Ut(t,e){if(1&t){const t=w.Rb();w.Qb(0,"div",33),w.Qb(1,"bla-actionbutton",30),w.Xb("click",(function(){w.pc(t);const e=w.Zb();return e.resetWettkampfToken(e.selectedWettkampfId)})),w.Cc(2),w.ac(3,"translate"),w.Pb(),w.Pb()}if(2&t){const t=w.Zb();w.zb(1),w.fc("color",t.ActionButtonColors.DANGER)("iconClass","trash")("disabled",t.isDisabled()),w.zb(1),w.Ec("",w.bc(3,4,"WKDURCHFUEHRUNG.BUTTON.OFFLINE_TOKEN")," ")}}let Nt=(()=>{class t extends l.CommonComponentDirective{constructor(t,e,n,a,i,s,c,r,l,o,b,f,m,p){super(),this.router=t,this.route=e,this.notificationService=n,this.veranstaltungsDataProvider=a,this.einstellungenDataProvider=i,this.wettkampfDataProvider=s,this.matchDataProvider=c,this.passeDataProviderService=r,this.matchProvider=l,this.onOfflineService=o,this.currentUserService=b,this.wettkampfOfflineSyncService=f,this.dialog=m,this.dsbMannschaftDataProviderService=p,this.ActionButtonColors=tt.a,this.config=h,this.config_table=u,this.config_table_match=d,this.PLACEHOLDER_VAR="Veranstaltung ausw\xe4hlen...",this.pdf=new Blob,this.multipleSelections=!0,this.loadingVeranstaltungen=!0,this.loadingWettkampfe=!1,this.loadingMatch=!1,this.tableContent=[],this.tableContentMatch=[],this.disabledButton=!0,this.disabledOtherButtons=!0,this.wettkaempfe=[new y.a],this.matches=[],this.loadingYears=!0,this.sessionHandling=new ct.a(this.currentUserService,this.onOfflineService)}ngOnInit(){this.route.params.subscribe(t=>{Object(E.c)(t.wettkampfId)?this.onOfflineService.isOffline()?(this.loadingWettkampfe=!0,this.wettkampfIdEnthalten=!0,this.wettkampfId=this.onOfflineService.getOfflineWettkampfID(),console.log("WettkampfID used for loading offlinepage Wkdurchfuehrung:",this.wettkampfId),this.findAvailableYears(),this.visible=!1):(this.wettkampfIdEnthalten=!1,this.findAvailableYears(),this.visible=!1):(this.wettkampfIdEnthalten=!0,this.wettkampfId=parseInt(t.wettkampfId,10),console.log("WettkampfID:",this.wettkampfId),this.findAvailableYears(),this.visible=!1)})}onMouseOver(t){this.sessionHandling.checkSessionExpired()&&window.location.reload()}isOffline(){return this.onOfflineService.isOffline()}isAdmin(){return this.currentUserService.hasPermission(R.j.CAN_MODIFY_STAMMDATEN)}resetWettkampfToken(t){return Object(r.a)(this,void 0,void 0,(function*(){try{yield this.wettkampfOfflineSyncService.resetWettkampfToken(t),this.notificationService.showNotification({id:"Offlinetoken gel\xf6scht",description:"Der Offlinetoken wurde erfolgreich gel\xf6scht und somit der Wettkampf entsperrt.",title:"Offlinetoken gel\xf6scht",origin:A.b.SYSTEM,userAction:A.f.ACCEPTED,type:A.e.OK,severity:A.d.INFO})}catch(e){this.notificationService.showNotification({id:"Offlinetoken gel\xf6scht Fehler",description:"Ein fehler ist aufgetreten und der Offlinetoken wurde nicht gel\xf6scht.",title:"Fehler beim L\xf6schen des Offlinetokens",origin:A.b.SYSTEM,userAction:A.f.ACCEPTED,type:A.e.OK,severity:A.d.INFO})}}))}onButtonGoOfflineClick(){return Object(r.a)(this,void 0,void 0,(function*(){if(this.onOfflineService.isOffline())try{yield this.wettkampfOfflineSyncService.goOnlineSync(this.onOfflineService.getOfflineWettkampfID()),this.onOfflineService.goOnline(),this.disabledOtherButtons=!0,this.notificationService.showNotification({id:"GO_ONLINE_ERROR",description:"WKDURCHFUEHRUNG.ONLINE.NOTIFICATION.SUCCESS.DESCRIPTION",title:"WKDURCHFUEHRUNG.ONLINE.NOTIFICATION.SUCCESS.TITLE",origin:A.b.SYSTEM,userAction:A.f.ACCEPTED,type:A.e.OK,severity:A.d.INFO})}catch(t){console.error(t),this.notificationService.discardNotification(),this.notificationService.showNotification({id:"GO_ONLINE_ERROR",description:"WKDURCHFUEHRUNG.ONLINE.NOTIFICATION.FAILURE.DESCRIPTION",title:"WKDURCHFUEHRUNG.ONLINE.NOTIFICATION.FAILURE.TITLE",origin:A.b.SYSTEM,userAction:A.f.ACCEPTED,type:A.e.OK,severity:A.d.ERROR})}else console.log("Going offline for Veranstaltung "+this.selectedVeranstaltungId),S.a.delete().then(()=>{S.a.open().then(()=>Object(r.a)(this,void 0,void 0,(function*(){console.log("Database opened");try{yield this.wettkampfOfflineSyncService.loadLigatabelleVeranstaltungOffline(this.selectedVeranstaltungId),yield this.wettkampfOfflineSyncService.loadMannschaftsmitgliedOffline(this.selectedWettkampfId),yield this.wettkampfOfflineSyncService.loadPasseOffline(this.selectedWettkampfId),yield this.wettkampfOfflineSyncService.loadMatchOffline(this.selectedWettkampfId),yield this.wettkampfOfflineSyncService.loadVeranstaltungOffline(this.selectedVeranstaltungId),yield this.wettkampfOfflineSyncService.loadDsbMitgliedOffline(),yield this.wettkampfOfflineSyncService.loadVereineOffline(),yield this.wettkampfOfflineSyncService.loadManschaftenOffline(),yield this.wettkampfOfflineSyncService.loadWettkampfOffline(this.selectedWettkampfId),this.onOfflineService.goOffline(this.selectedWettkampfId,this.selectedDTOs[0].sportjahr),this.loadingVeranstaltungen=!0,this.wettkampfIdEnthalten=!0,this.wettkampfId=this.onOfflineService.getOfflineWettkampfID(),yield this.LoadWettkampf(),this.visible=!1,this.notificationService.showNotification({id:"OFFLINE_MODE_ON",description:"WKDURCHFUEHRUNG.OFFLINE.NOTIFICATION.SUCCESS.DESCRIPTION",title:"WKDURCHFUEHRUNG.OFFLINE.NOTIFICATION.SUCCESS.TITLE",origin:A.b.SYSTEM,userAction:A.f.ACCEPTED,type:A.e.OK,severity:A.d.INFO})}catch(t){console.error("Error while loading offline data"),this.notificationService.showNotification({id:"OFFLINE_MODE_OFF",description:"WKDURCHFUEHRUNG.OFFLINE.NOTIFICATION.FAILURE.DESCRIPTION",title:"WKDURCHFUEHRUNG.OFFLINE.NOTIFICATION.FAILURE.TITLE",origin:A.b.SYSTEM,userAction:A.f.PENDING,type:A.e.OK,severity:A.d.ERROR})}})))})}))}LoadWettkampf(){return Object(r.a)(this,void 0,void 0,(function*(){this.loadingWettkampfe=!0,this.wettkampfDataProvider.findAll().then(t=>this.handleLoadWettkampfSuccess(t)).catch(()=>this.handleLoadWettkampfFailure())}))}handleLoadWettkampfFailure(){console.log("ERROR: Keine Wettkaempfe gefunden"),this.wettkampfIdEnthalten=!1,this.loadingWettkampfe=!1,this.loadVeranstaltungen()}handleLoadWettkampfSuccess(t){this.wettkaempfe=[],this.wettkaempfe=t.payload,this.wettkaempfe.forEach(t=>this.findWettkampf(t))}findWettkampf(t){this.wettkampfId===t.id&&(this.wettkampf=t,this.loadVeranstaltungen())}onSelectYear(t){this.veranstaltungsDataProvider.findBySportyearLaufend(t.sportjahr).then(t=>{this.veranstaltungen=t.payload,this.loadingVeranstaltungen=!1}).catch(()=>{this.loadVeranstaltungenYearsFailure()})}loadVeranstaltungen(){this.veranstaltungen=[],this.selectedWettkampf="",this.selectedWettkampfId=null,this.veranstaltungsDataProvider.findAll().then(t=>{this.loadVeranstaltungenSuccess(t)}).catch(t=>{this.loadVeranstaltungenFailure(t)})}loadVeranstaltungenSuccess(t){this.veranstaltungen=t.payload,this.loadingVeranstaltungen=!1,this.wettkampfIdEnthalten&&this.veranstaltungen.forEach(t=>this.findVeranstaltung(t))}loadVeranstaltungenFailure(t){this.veranstaltungen=t.payload}findVeranstaltung(t){if(this.wettkampf.wettkampfVeranstaltungsId===t.id){let e,n;this.veranstaltung=t,this.currentVeranstaltungName=this.veranstaltung.name+" "+this.veranstaltung.sportjahr;for(const t of this.availableYears)t.sportjahr===this.veranstaltung.sportjahr&&(this.selItemId=t.id,e=t);n=[this.veranstaltung],this.onSelectYear(e),this.onSelect(n),this.onView(this.wettkampf)}}loadVeranstaltungenByYear(t){return Object(r.a)(this,void 0,void 0,(function*(){this.veranstaltungen=[],this.selectedWettkampf="",this.selectedWettkampfId=null,this.veranstaltungsDataProvider.findBySportyearLaufend(t).then(t=>{this.loadVeranstaltungenSuccess(t)}).catch(t=>{this.loadVeranstaltungenFailure(t)})}))}onSelect(t){this.disabledButton=!0,this.selectedDTOs=[],this.selectedDTOs=t,this.selectedDTOs&&this.selectedDTOs.length>0&&(this.selectedVeranstaltungId=this.selectedDTOs[0].id),this.veranstaltungsDataProvider.findById(this.selectedVeranstaltungId).then(t=>{this.currentVeranstaltungName=t.payload.name+" "+t.payload.sportjahr}).catch(t=>{console.log("error in onSelect wkdurchfuehrung"),console.log(t),this.currentVeranstaltungName=""}),this.rows=[],this.tableContent=[],null!=this.selectedVeranstaltungId&&this.loadTableRows()}onView(t){if(t.id>=0){this.selectedWettkampfId=t.id,this.selectedWettkampf=t.id.toString(),this.selectedWettkampfListeIndex=0;for(let t=0;t<this.wettkampfListe.length;t++)this.wettkampfListe[t].id===this.selectedWettkampfId&&(this.selectedWettkampfListeIndex=t);const e=t;document.getElementById("WettkampfTitle").innerText=this.currentVeranstaltungName+" - "+e.wettkampfTag+". Wettkampftag",this.visible=!0,this.tableContentMatch=[],this.showMatches()}}checkMannschaften(){this.dsbMannschaftDataProviderService.findAllByVeranstaltungsId(this.selectedVeranstaltungId).then(t=>{this.disabledButton=!(t.payload.length>0)})}showMatches(){this.disabledButton=!0,this.matchProvider.findAllWettkampfMatchesAndNamesById(this.selectedWettkampfId).then(t=>{0!==t.payload.length?this.checkMannschaften():(this.checkMannschaften(),0===this.selectedWettkampfListeIndex?this.disabledButton=!1:this.matchProvider.findAllWettkampfMatchesAndNamesById(this.wettkampfListe[this.selectedWettkampfListeIndex-1].id).then(t=>{this.disabledButton=0===t.payload.length}).catch(t=>{console.error("Error at findAllWettkampfMatchesAndNamesByID: "+t)})),this.handleFindMatchSuccess(t)}).catch(()=>this.handleFindMatchFailure())}onMap(t){const e=t;Object(F.a)(e)}onButtonTabletClick(){this.router.navigateByUrl("/wkdurchfuehrung/tabletadmin/"+this.selectedWettkampf)}onButtonDownload(t){return(new b.UriBuilder).fromPath(D.a.backendBaseUrl).path("v1/download").path(t).path("?wettkampfid="+this.selectedWettkampf).build()}isDisabled(){return this.disabledOtherButtons}isOfflineDisabled(){return this.onOfflineService.isOffline()}isDisabledGMButton(){return this.disabledButton}generateMatches(){this.matchDataProvider.generateDataForMatches(this.selectedWettkampfId).then(()=>{this.showMatches()}).catch(t=>{this.handleFailureGenerateMatchesMissingMitglied(),this.showMatches()})}handleFailureGenerateMatchesMissingMitglied(){this.notificationService.showNotification({id:"NOTIFICATION_GENERIERE_MATCHES_MITGLIED_FEHLT",title:"WKDURCHFUEHRUNG.GENERIERE_MATCHES_MITGLIED_FEHLT.NOTIFICATION.TITLE",description:"WKDURCHFUEHRUNG.GENERIERE_MATCHES_MITGLIED_FEHLT.NOTIFICATION.DESCRIPTION",severity:A.d.INFO,origin:A.b.USER,type:A.e.OK,userAction:A.f.ACCEPTED})}handleFailureGenerateMatches(){this.notificationService.showNotification({id:"NOTIFICATION_GENERIERE_MATCHES",title:"WKDURCHFUEHRUNG.GENERIERE_MATCHES.NOTIFICATION.TITLE",description:"WKDURCHFUEHRUNG.GENERIERE_MATCHES.NOTIFICATION.DESCRIPTION",severity:A.d.INFO,origin:A.b.USER,type:A.e.OK,userAction:A.f.ACCEPTED})}onEdit(t){t.id>=0&&(this.selectedMatchId=t.id,this.matchProvider.pair(this.selectedMatchId).then(t=>{2===t.payload.length&&this.router.navigate(["/wkdurchfuehrung/schusszettel/"+t.payload[0]+"/"+t.payload[1]])}))}loadTableRows(){this.loadingWettkampfe=!0,this.selectedWettkampf="",this.selectedWettkampfId=null,this.wettkampfDataProvider.findAllByVeranstaltungId(this.selectedVeranstaltungId).then(t=>{this.wettkampfListe=t.payload,this.handleFindWettkampfSuccess(t)}).catch(()=>this.handleFindWettkampfFailure())}handleFindWettkampfFailure(){this.rows=[],this.loadingWettkampfe=!1}handleFindWettkampfSuccess(t){this.rows=[],this.remainingWettkampfRequests=t.payload.length,t.payload.length<=0&&(this.loadingWettkampfe=!1);for(const e of t.payload){const t=new y.a;t.wettkampfStrasse=e.wettkampfStrasse,t.wettkampfPlz=e.wettkampfPlz,t.wettkampfOrtsname=e.wettkampfOrtsname,t.wettkampfOrtsinfo=e.wettkampfOrtsinfo,t.wettkampfBeginn=e.wettkampfBeginn,t.wettkampfTag=e.wettkampfTag,t.wettkampfDatum=e.wettkampfDatum,t.id=e.id,t.wettkampfVeranstaltungsId=e.wettkampfVeranstaltungsId,t.version=e.version,this.tableContent.push(t)}this.rows=Object(l.toTableRows)(this.tableContent),this.loadingWettkampfe=!1}handleFindMatchFailure(){this.matchRows=[],this.loadingMatch=!1}handleFindMatchSuccess(t){this.matchRows=[],this.remainingMatchRequests=t.payload.length,t.payload.length<=0&&(this.loadingMatch=!1);for(const e of t.payload){const t=new T;t.id=e.id,t.nr=e.nr,t.begegnung=e.begegnung,t.scheibenNummer=e.scheibenNummer,t.mannschaftName=e.mannschaftName,t.matchpunkte=e.matchpunkte,t.satzpunkte=e.satzpunkte,t.version=e.version,this.tableContentMatch.push(t)}this.matchRows=Object(l.toTableRows)(this.tableContentMatch),this.loadingMatch=!1}findAvailableYears(){return Object(r.a)(this,void 0,void 0,(function*(){this.availableYears=[],this.onOfflineService.isOffline()||(this.aktivesSportjahr=yield Object(st.a)(this.einstellungenDataProvider)),this.veranstaltungsDataProvider.findAllSportyearDestinct().then(t=>{this.loadVeranstaltungenYearsSuccess(t)}).catch(()=>{this.loadVeranstaltungenYearsFailure()})}))}loadVeranstaltungenYearsSuccess(t){this.loadingYears=!1;let e=1,n=0;if(t.payload!==[]){for(const e of t.payload){const t=new Q;t.sportjahr=e.sportjahr.valueOf(),t.version=1,this.availableYears.push(t)}this.availableYears.sort((t,e)=>t.sportjahr.valueOf()<e.sportjahr.valueOf()?1:t.sportjahr.valueOf()>e.sportjahr.valueOf()?-1:void 0);for(const t of this.availableYears)t.id=e,t.sportjahr===this.aktivesSportjahr&&(n=e-1),e++;this.wettkampfIdEnthalten?this.onOfflineService.isOffline()&&(this.selItemId=this.availableYears[n].id,this.LoadWettkampf()):(this.selItemId=this.availableYears[n].id,this.loadVeranstaltungenByYear(this.availableYears[n].sportjahr.valueOf()))}}loadVeranstaltungenYearsFailure(){this.loadingYears=!1}addDSBMitglied(){this.dialog.open(it)}}return t.\u0275fac=function(e){return new(e||t)(w.Lb(s.c),w.Lb(s.a),w.Lb(A.c),w.Lb(m.a),w.Lb(f.a),w.Lb(p.a),w.Lb(g.a),w.Lb(L.a),w.Lb(H),w.Lb(R.i),w.Lb(R.a),w.Lb(J),w.Lb(et.b),w.Lb($.a))},t.\u0275cmp=w.Fb({type:t,selectors:[["bla-wkdurchfuehrung"]],features:[w.wb],decls:76,vars:94,consts:[[3,"config"],[3,"mouseover"],["href","https://wiki.bsapp.de/doku.php?id=liga:wettkampfdurchfuehrung","target","_blank"],[1,"subtitle"],[1,"layout-elements"],[1,"flexChild"],["routerLink","/wkdurchfuehrung",1,"blackLink"],["id","dropDownMenuYear",2,"width","80%","margin-bottom","2%"],["data-cy","wkduchfuehrung-jahr-dropdown",2,"width","40%",3,"id","items","optionFieldSelector","loading","selectedItemId","disabled","onSelect"],["id","example",1,"table","table-hover","table-sm","table-responsive-sm","thead-light","table-striped",2,"width","80%"],["selectionListHeight","15em","data-cy","wkduchfuehrung-veranstaltung-list",2,"width","40%","flex-grow","0",3,"items","loading","multipleSelections","placeholderTranslationKey","optionFieldSelector","disabled","onSelect"],[1,"row"],[1,"overview-dialog-content"],["data-cy","wkdurchfuehrung-wettkampftage-list",3,"config","rows","loading","onViewEntry","onMapEntry"],[3,"veranstaltungsId"],["id","WettkampfTitle"],[3,"id","disabled","color","iconClass","onClick"],[3,"id","downloadUrl","fileName","color","iconClass","disabled"],[3,"id","downloadUrl","fileName","disabled","color","iconClass"],["id","setupTable",4,"ngIf","ngIfElse"],[3,"id","color","iconClass","onClick"],["id","onlineSetupTables"],["onlineSetupTables",""],["id","offlineButton",4,"ngIf","ngIfElse"],["id","onlineButton"],["backOnline",""],["id","adminOfflineResetButton",4,"ngIf"],[1,"row",2,"margin-left","5px"],["data-cy","wkdurchfuehrung-match-list",3,"config","rows","loading","onEditEntry"],["id","setupTable"],[3,"color","iconClass","disabled","click"],["id","offlineButton"],["data-cy","wkdurchfuehrung-btn-offlinegehen",3,"color","iconClass","disabled","click"],["id","adminOfflineResetButton"]],template:function(t,e){if(1&t&&(w.Qb(0,"bla-common-dialog",0),w.Qb(1,"div",1),w.Xb("mouseover",(function(t){return e.onMouseOver(t)})),w.Mb(2,"bla-hilfe-button",2),w.Qb(3,"p",3),w.Cc(4),w.ac(5,"translate"),w.Pb(),w.Qb(6,"div",4),w.Qb(7,"bla-col-layout"),w.Qb(8,"div",5),w.Qb(9,"h2"),w.Qb(10,"a",6),w.Cc(11),w.ac(12,"translate"),w.Pb(),w.Pb(),w.Qb(13,"div",7),w.Qb(14,"bla-dropdown-menu",8),w.Xb("onSelect",(function(t){return e.onSelectYear(t)})),w.Pb(),w.Pb(),w.Qb(15,"table",9),w.Qb(16,"bla-quicksearch-list",10),w.Xb("onSelect",(function(t){return e.onSelect(t)})),w.Pb(),w.Pb(),w.Pb(),w.Qb(17,"div"),w.Qb(18,"h2"),w.Cc(19),w.ac(20,"translate"),w.Pb(),w.Qb(21,"div",11),w.Qb(22,"section",12),w.Qb(23,"bla-data-table",13),w.Xb("onViewEntry",(function(t){return e.onView(t)}))("onMapEntry",(function(t){return e.onMap(t)})),w.Pb(),w.Mb(24,"bla-teilnemende-manschaften-tabelle",14),w.Pb(),w.Pb(),w.Pb(),w.Pb(),w.Qb(25,"bla-col-layout"),w.Mb(26,"h2",15),w.Pb(),w.Qb(27,"bla-col-layout"),w.Qb(28,"div"),w.Mb(29,"BR"),w.Qb(30,"h2"),w.Cc(31),w.ac(32,"translate"),w.Pb(),w.Qb(33,"p"),w.Cc(34),w.ac(35,"translate"),w.Pb(),w.Pb(),w.Pb(),w.Qb(36,"bla-col-layout"),w.Qb(37,"bla-actionbutton",16),w.Xb("onClick",(function(){return e.generateMatches()})),w.Cc(38),w.ac(39,"translate"),w.Pb(),w.Qb(40,"bla-download-actionbutton",17),w.Cc(41),w.ac(42,"translate"),w.Pb(),w.Qb(43,"bla-download-actionbutton",17),w.Cc(44),w.ac(45,"translate"),w.Pb(),w.Qb(46,"bla-download-actionbutton",18),w.Cc(47),w.ac(48,"translate"),w.Pb(),w.Qb(49,"bla-download-actionbutton",17),w.Cc(50),w.ac(51,"translate"),w.Pb(),w.Ac(52,Et,4,6,"div",19),w.Qb(53,"bla-actionbutton",20),w.Xb("onClick",(function(){return e.addDSBMitglied()})),w.Cc(54),w.ac(55,"translate"),w.Pb(),w.Ac(56,Ct,4,6,"ng-template",21,22,w.Bc),w.Ac(58,Tt,4,6,"div",23),w.Ac(59,Pt,4,6,"ng-template",24,25,w.Bc),w.Ac(61,Ut,4,6,"div",26),w.Pb(),w.Qb(62,"bla-col-layout"),w.Mb(63,"BR"),w.Qb(64,"h2"),w.Mb(65,"BR"),w.Cc(66),w.ac(67,"translate"),w.Mb(68,"BR"),w.Cc(69,"\xa0"),w.Pb(),w.Mb(70,"BR"),w.Pb(),w.Qb(71,"bla-col-layout"),w.Qb(72,"div",27),w.Qb(73,"section",12),w.Qb(74,"bla-data-table",28),w.Xb("onEditEntry",(function(t){return e.onEdit(t)})),w.Pb(),w.Pb(),w.Pb(),w.Pb(),w.Mb(75,"router-outlet"),w.Pb(),w.Pb(),w.Pb()),2&t){const t=w.oc(57),n=w.oc(60);w.fc("config",e.config),w.zb(4),w.Dc(w.bc(5,70,"WKDURCHFUEHRUNG.WKDURCHFUEHRUNG.DESCRIPTION")),w.zb(7),w.Dc(w.bc(12,72,"WKDURCHFUEHRUNG.TITEL.VERANSTALTUNG")),w.zb(3),w.fc("id","Veranstaltungen-dropdown-menu")("items",e.availableYears)("optionFieldSelector","sportjahr")("loading",e.loadingYears)("selectedItemId",e.selItemId)("disabled",e.isOfflineDisabled()),w.zb(2),w.fc("items",e.veranstaltungen)("loading",e.loadingVeranstaltungen)("multipleSelections",!e.multipleSelections)("placeholderTranslationKey",e.PLACEHOLDER_VAR)("optionFieldSelector","name")("disabled",e.isOfflineDisabled()),w.zb(3),w.Ec(" ",w.bc(20,74,"WKDURCHFUEHRUNG.TITEL.WKTAG")," "),w.zb(4),w.fc("config",e.config_table)("rows",e.rows)("loading",e.loadingWettkampfe),w.zb(1),w.fc("veranstaltungsId",e.selectedVeranstaltungId),w.zb(7),w.Dc(w.bc(32,76,"MANNSCHAFTEN.LIGATABELLE.LIGATABELLE_VORBEREITUNG")),w.zb(3),w.Dc(w.bc(35,78,"MANNSCHAFTEN.LIGATABELLE.TEXT")),w.zb(2),w.wc("flex-wrap: wrap"),w.zb(1),w.fc("id","generiereMatches")("disabled",e.isDisabledGMButton())("color",e.ActionButtonColors.PRIMARY)("iconClass","cogs"),w.zb(1),w.Ec(" ",w.bc(39,80,"WKDURCHFUEHRUNG.BUTTON.MATCHES")," "),w.zb(2),w.fc("id","downloadSetzliste")("downloadUrl",e.onButtonDownload("pdf/setzliste"))("fileName","setzliste.pdf")("color",e.ActionButtonColors.PRIMARY)("iconClass","file-download")("disabled",e.isDisabled()),w.zb(1),w.Ec("",w.bc(42,82,"WKDURCHFUEHRUNG.BUTTON.SETZLISTE")," "),w.zb(2),w.fc("id","downloadSchusszettel")("downloadUrl",e.onButtonDownload("pdf/schusszettel"))("fileName","schusszettel.pdf")("color",e.ActionButtonColors.PRIMARY)("iconClass","file-download")("disabled",e.isDisabled()),w.zb(1),w.Ec("",w.bc(45,84,"WKDURCHFUEHRUNG.BUTTON.SCHUSSZETTEL")," "),w.zb(2),w.fc("id","downloadBogenkontrollliste")("downloadUrl",e.onButtonDownload("pdf/bogenkontrollliste"))("fileName","bogenkontrollliste.pdf")("disabled",e.isDisabled())("color",e.ActionButtonColors.PRIMARY)("iconClass","file-download"),w.zb(1),w.Ec(" ",w.bc(48,86,"WKDURCHFUEHRUNG.BUTTON.KONTROLLLISTE")," "),w.zb(2),w.fc("id","downloadMeldezettel")("downloadUrl",e.onButtonDownload("pdf/meldezettel"))("fileName","meldezettel.pdf")("color",e.ActionButtonColors.PRIMARY)("iconClass","file-download")("disabled",e.isDisabled()),w.zb(1),w.Ec("",w.bc(51,88,"WKDURCHFUEHRUNG.BUTTON.MELDEZETTEL")," "),w.zb(2),w.fc("ngIf",!e.isOffline())("ngIfElse",t),w.zb(1),w.fc("id","DSB-Mitglied anlegen")("color",e.ActionButtonColors.PRIMARY)("iconClass","user-plus"),w.zb(1),w.Ec(" ",w.bc(55,90,"WKDURCHFUEHRUNG.BUTTON.MITGLIED_ANLEGEN")," "),w.zb(4),w.fc("ngIf",!e.isOffline())("ngIfElse",n),w.zb(3),w.fc("ngIf",e.isAdmin()),w.zb(5),w.Ec("",w.bc(67,92,"WKDURCHFUEHRUNG.TITEL.LT_DURCHFUEHRUNG")," "),w.zb(8),w.fc("config",e.config_table_match)("rows",e.matchRows)("loading",e.loadingMatch)}},directives:[rt.a,lt.a,ot.a,s.f,ht.a,ut.a,dt.a,pt,at.a,gt.a,a.t,s.h],pipes:[St.d],styles:[""]}),t})(),It=(()=>{class t extends b.DataProviderService{constructor(t,e,n){super(),this.restClient=t,this.onOfflineService=e,this.passeDataProvider=n,this.serviceSubUrl="v1/match/schusszettel"}findMatches(t,e){if(this.onOfflineService.isOffline()){let n=[];return new Promise((a,i)=>{this.passeDataProvider.findOfflineByMatchIds(Number(t),Number(e)).then(i=>{n=Object(W.c)(i.payload),this.offlineFindMatches(Number(t),Number(e),n).then(t=>{a({result:b.RequestResult.SUCCESS,payload:t.payload})})}).catch(t=>console.error(t))})}return new Promise((n,a)=>{this.restClient.GET((new b.UriBuilder).fromPath(this.getUrl()).path(t).path(e).build()).then(t=>{console.log("data in MatchDTO",t);const e=[z.matchToDO(t[0]),z.matchToDO(t[1])];n({result:b.RequestResult.SUCCESS,payload:e})},t=>{a(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})})})}offlineFindMatches(t,e,n){return new Promise((a,i)=>{S.a.matchTabelle.bulkGet([t,e]).then(t=>{a({result:b.RequestResult.SUCCESS,payload:[z.matchToDO(O(t[0],n)),z.matchToDO(O(t[1],n))]})},()=>{i({result:b.RequestResult.FAILURE})})})}offlineAddPassen(t){return Object(r.a)(this,void 0,void 0,(function*(){S.a.transaction("rw",S.a.passeTabelle,e=>Object(r.a)(this,void 0,void 0,(function*(){let e=0,n=new Map;yield S.a.passeTabelle.toArray().then(t=>{t.forEach(t=>{n.set(t.id,t.passeId),t.id>=e&&(e=t.id)})}),t.passen.filter(t=>t).forEach(t=>{var a,i;null===t.id&&(e+=1),S.a.passeTabelle.put({offlineVersion:2,id:null!==(a=t.id)&&void 0!==a?a:e,passeId:n.get(t.id),dsbMitgliedId:t.dsbMitgliedId,lfdNr:t.lfdNr,mannschaftId:t.mannschaftId,matchID:t.matchId,matchNr:t.matchNr,ringzahlPfeil1:t.ringzahl[0],ringzahlPfeil2:t.ringzahl[1],ringzahlPfeil3:t.ringzahl[2],ringzahlPfeil4:t.ringzahl[3],ringzahlPfeil5:t.ringzahl[4],ringzahlPfeil6:0,rueckennummer:t.rueckennummer,version:2,wettkampfId:t.wettkampfId},null!==(i=t.id)&&void 0!==i?i:e).then(t=>console.log(t+" passe offline hinzugef\xfcgt")).catch(t=>console.error(t))})})))}))}create(t,e){const n=z.matchToDTO(t),a=z.matchToDTO(e);return this.onOfflineService.isOffline()?new Promise((t,e)=>{S.a.transaction("rw",S.a.matchTabelle,S.a.passeTabelle,t=>Object(r.a)(this,void 0,void 0,(function*(){yield S.a.matchTabelle.update(n.id,{matchpkt:n.matchpunkte,satzpunkte:n.satzpunkte,strafpunkteSatz1:n.strafPunkteSatz1,strafpunkteSatz2:n.strafPunkteSatz2,strafpunkteSatz3:n.strafPunkteSatz3,strafpunkteSatz4:n.strafPunkteSatz4,strafpunkteSatz5:n.strafPunkteSatz5,offlineVersion:2}),yield S.a.matchTabelle.update(a.id,{matchpkt:a.matchpunkte,satzpunkte:a.satzpunkte,strafpunkteSatz1:a.strafPunkteSatz1,strafpunkteSatz2:a.strafPunkteSatz2,strafpunkteSatz3:a.strafPunkteSatz3,strafpunkteSatz4:a.strafPunkteSatz4,strafpunkteSatz5:a.strafPunkteSatz5,offlineVersion:2}),yield this.offlineAddPassen(n),yield this.offlineAddPassen(a),S.a.passeTabelle.where("matchID").equals(n.id).or("matchID").equals(a.id).modify(t=>{t.version?t.version+=1:t.version=2})}))).then(()=>{this.findMatches(n.id.toString(),a.id.toString()).then(e=>t({result:b.RequestResult.SUCCESS,payload:e.payload}))}).catch(t=>e(t))}):new Promise((t,e)=>{this.restClient.POST(this.getUrl(),[n,a]).then(e=>{const n=[z.matchToDO(e[0]),z.matchToDO(e[1])];t({result:b.RequestResult.SUCCESS,payload:n})},t=>{e(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})})})}}return t.\u0275fac=function(e){return new(e||t)(w.Ub(b.RestClient),w.Ub(R.i),w.Ub(L.a))},t.\u0275prov=w.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var zt=n("TmMT"),Rt=n("v1Mt");let kt=(()=>{class t{constructor(t,e,n,a,i){this.specialKeys=["Backspace","Tab","End","Home","Delete","Del","ArrowLeft","ArrowRight","Left","Right","Shift"],this.ALIAS_10="+",this.el=t,this.notificationService=i,this.allowedKeys=e,this.MIN_VAL=n,this.MAX_VAL=a}notificationMethod(t){this.notificationService.showNotification({id:"NOTIFICATION_SCHUSSZETTEL_EINGABEFEHLER",title:"WKDURCHFUEHRUNG.SCHUSSZETTEL.NOTIFICATION.EINGABEFEHLER.TITLE",description:"WKDURCHFUEHRUNG.SCHUSSZETTEL.NOTIFICATION.EINGABEFEHLER.DESCRIPTION",severity:R.f.INFO,origin:R.d.USER,type:R.g.OK,userAction:R.h.PENDING}),t.preventDefault()}inRange(t){return parseInt(t,10)>=this.MIN_VAL&&parseInt(t,10)<=this.MAX_VAL}onKeyDown(t){-1===this.specialKeys.indexOf(t.key)&&(this.allowedKeys.includes(t.key)&&this.inRange(this.el.nativeElement.value+parseInt(t.key,10))||this.notificationMethod(t))}onKeyUp(t){if(-1===this.specialKeys.indexOf(t.key)&&(this.allowedKeys.includes(t.key)||this.inRange(this.el.nativeElement.value+parseInt(t.key,10)))){const t=parseInt(this.el.nativeElement.getAttribute("tabindex"),10);document.querySelector('[tabindex="'+(t+1)+'"]').focus()}}}return t.\u0275fac=function(t){w.Wb()},t.\u0275dir=w.Gb({type:t,hostBindings:function(t,e){1&t&&w.Xb("keydown",(function(t){return e.onKeyDown(t)}))("keyup",(function(t){return e.onKeyUp(t)}))}}),t})(),vt=(()=>{class t extends kt{constructor(t,e){super(t,["1","2","3","4","5","6","7","8","9","0"],0,10,e),this.ALIAS_10="+"}onKeyDown(t){-1===this.specialKeys.indexOf(t.key)&&(t.key!==this.ALIAS_10?this.allowedKeys.includes(t.key)&&this.inRange(this.el.nativeElement.value+parseInt(t.key,10))||this.notificationMethod(t):this.el.nativeElement.value="10")}}return t.\u0275fac=function(e){return new(e||t)(w.Lb(w.l),w.Lb(R.e))},t.\u0275dir=w.Gb({type:t,selectors:[["","blaPfeilNumberOnly",""]],hostBindings:function(t,e){1&t&&w.Xb("keydown",(function(t){return e.onKeyDown(t)}))},features:[w.wb]}),t})(),Ot=(()=>{class t extends kt{constructor(t,e){super(t,["1","2","3","4","5","6","7","8","9","0"],1,99,e)}}return t.\u0275fac=function(e){return new(e||t)(w.Lb(w.l),w.Lb(R.e))},t.\u0275dir=w.Gb({type:t,selectors:[["","blaSchuetzeNumberOnly",""]],features:[w.wb]}),t})(),Mt=(()=>{class t extends kt{constructor(t,e){super(t,["1","2","3","4","5","6","7","8","9","0"],0,60,e)}}return t.\u0275fac=function(e){return new(e||t)(w.Lb(w.l),w.Lb(R.e))},t.\u0275dir=w.Gb({type:t,selectors:[["","blaFehlerNumberOnly",""]],features:[w.wb]}),t})();var wt=n("xRjW");class Ht{getNext(){if(this.currIdx<this.indices.length){const t=this.indices[this.currIdx];return this.currIdx+=1,t}return this.currIdx=0,this.getNext()}}const yt=new class extends Ht{constructor(){super(),this.indices=[1,2,3,34,35,36],this.currIdx=0}},At=new class extends Ht{constructor(){super();const t=[[4,29],[6,31],[8,33],[37,62],[39,64],[41,66]];this.indices=[];for(const e of t)for(let t=e[0];t<=e[1];t+=6)this.indices.push(t),this.indices.push(t+1);this.currIdx=0}};class Dt{constructor(t){this.el=t}}let Ft=(()=>{class t extends Dt{constructor(t){super(t),this.el.nativeElement.setAttribute("tabindex",yt.getNext())}}return t.\u0275fac=function(e){return new(e||t)(w.Lb(w.l))},t.\u0275dir=w.Gb({type:t,selectors:[["","blaSchuetzenTabIndexDirective",""]],features:[w.wb]}),t})(),Lt=(()=>{class t extends Dt{constructor(t){super(t),this.el.nativeElement.setAttribute("tabindex",At.getNext())}}return t.\u0275fac=function(e){return new(e||t)(w.Lb(w.l))},t.\u0275dir=w.Gb({type:t,selectors:[["","blaRingzahlTabIndexDirective",""]],features:[w.wb]}),t})();function Qt(t,e){if(1&t&&(w.Qb(0,"td"),w.Qb(1,"label"),w.Cc(2),w.ac(3,"translate"),w.Pb(),w.Mb(4,"input",8),w.Pb()),2&t){const t=e.$implicit,n=e.index;w.zb(2),w.Fc("",n+1,". ",w.bc(3,3,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ"),""),w.zb(2),w.fc("value",t)}}function Gt(t,e){if(1&t&&(w.Qb(0,"td"),w.Mb(1,"input",8),w.Pb()),2&t){const t=e.$implicit;w.zb(1),w.fc("value",t)}}function _t(t,e){if(1&t){const t=w.Rb();w.Qb(0,"td"),w.Qb(1,"input",39),w.Xb("ngModelChange",(function(e){return w.pc(t),w.Zb().$implicit.rueckennummer=e}))("ngModelChange",(function(e){w.pc(t);const n=w.Zb(2).index;return w.Zb().onSchuetzeChange(e,1,n)})),w.Pb(),w.Pb()}if(2&t){const t=w.Zb().$implicit;w.zb(1),w.fc("ngModel",t.rueckennummer)}}function Wt(t,e){if(1&t){const t=w.Rb();w.Ac(0,_t,2,1,"td",36),w.Qb(1,"td",37),w.Qb(2,"input",38),w.Xb("ngModelChange",(function(n){w.pc(t);const a=e.index,i=w.Zb().index;return w.Zb().onChange(n,1,i,a,1)})),w.Pb(),w.Pb(),w.Qb(3,"td"),w.Qb(4,"input",38),w.Xb("ngModelChange",(function(n){w.pc(t);const a=e.index,i=w.Zb().index;return w.Zb().onChange(n,1,i,a,2)})),w.Pb(),w.Pb()}if(2&t){const t=e.$implicit;w.fc("ngIf",0==e.index),w.zb(2),w.fc("ngModel",t.ringzahlPfeil1),w.zb(2),w.fc("ngModel",t.ringzahlPfeil2)}}function Kt(t,e){if(1&t&&(w.Qb(0,"td"),w.Cc(1),w.ac(2,"translate"),w.Pb(),w.Qb(3,"td"),w.Mb(4,"input",40),w.Pb()),2&t){const t=e.$implicit;w.zb(1),w.Dc(w.bc(2,2,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SUMME")),w.zb(3),w.fc("value",t)}}function Zt(t,e){if(1&t&&(w.Qb(0,"tr"),w.Mb(1,"td"),w.Ac(2,Kt,5,4,"ng-template",14),w.Pb()),2&t){const t=w.Zb(2);w.zb(2),w.fc("ngForOf",t.match1.sumSatz)}}function Bt(t,e){if(1&t&&(w.Qb(0,"tr"),w.Ac(1,Wt,5,3,"ng-template",14),w.Qb(2,"td",35),w.Cc(3),w.Pb(),w.Pb(),w.Ac(4,Zt,3,1,"tr",36)),2&t){const t=e.index,n=e.$implicit,a=w.Zb();w.zb(1),w.fc("ngForOf",n),w.zb(2),w.Ec(" ",a.getSummeSchuetze(t,1)," "),w.zb(1),w.fc("ngIf",t>=a.match1.schuetzen.length-1)}}function xt(t,e){if(1&t&&(w.Qb(0,"td"),w.Qb(1,"label"),w.Cc(2),w.ac(3,"translate"),w.Pb(),w.Mb(4,"input",8),w.Pb()),2&t){const t=e.$implicit,n=e.index;w.zb(2),w.Fc("",n+1,". ",w.bc(3,3,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ"),""),w.zb(2),w.fc("value",t)}}function Vt(t,e){if(1&t&&(w.Qb(0,"td"),w.Mb(1,"input",8),w.Pb()),2&t){const t=e.$implicit;w.zb(1),w.fc("value",t)}}function jt(t,e){if(1&t){const t=w.Rb();w.Qb(0,"td"),w.Qb(1,"input",39),w.Xb("ngModelChange",(function(e){return w.pc(t),w.Zb().$implicit.rueckennummer=e}))("ngModelChange",(function(e){w.pc(t);const n=w.Zb(2).index;return w.Zb().onSchuetzeChange(e,1,n)})),w.Pb(),w.Pb()}if(2&t){const t=w.Zb().$implicit;w.zb(1),w.fc("ngModel",t.rueckennummer)}}function qt(t,e){if(1&t){const t=w.Rb();w.Ac(0,jt,2,1,"td",36),w.Qb(1,"td",37),w.Qb(2,"input",38),w.Xb("ngModelChange",(function(n){w.pc(t);const a=e.index,i=w.Zb().index;return w.Zb().onChange(n,2,i,a,1)})),w.Pb(),w.Pb(),w.Qb(3,"td"),w.Qb(4,"input",38),w.Xb("ngModelChange",(function(n){w.pc(t);const a=e.index,i=w.Zb().index;return w.Zb().onChange(n,2,i,a,2)})),w.Pb(),w.Pb()}if(2&t){const t=e.$implicit;w.fc("ngIf",0==e.index),w.zb(2),w.fc("ngModel",t.ringzahlPfeil1),w.zb(2),w.fc("ngModel",t.ringzahlPfeil2)}}function Yt(t,e){if(1&t&&(w.Qb(0,"td"),w.Cc(1),w.ac(2,"translate"),w.Pb(),w.Qb(3,"td"),w.Mb(4,"input",40),w.Pb()),2&t){const t=e.$implicit;w.zb(1),w.Dc(w.bc(2,2,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SUMME")),w.zb(3),w.fc("value",t)}}function Xt(t,e){if(1&t&&(w.Qb(0,"tr"),w.Mb(1,"td"),w.Ac(2,Yt,5,4,"ng-template",14),w.Pb()),2&t){const t=w.Zb(2);w.zb(2),w.fc("ngForOf",t.match2.sumSatz)}}function $t(t,e){if(1&t&&(w.Qb(0,"tr"),w.Ac(1,qt,5,3,"ng-template",14),w.Qb(2,"td",35),w.Cc(3),w.Pb(),w.Pb(),w.Ac(4,Xt,3,1,"tr",36)),2&t){const t=e.index,n=e.$implicit,a=w.Zb();w.zb(1),w.fc("ngForOf",n),w.zb(2),w.Ec(" ",a.getSummeSchuetze(t,2)," "),w.zb(1),w.fc("ngIf",t>=a.match2.schuetzen.length-1)}}function Jt(t,e){if(1&t){const t=w.Rb();w.Qb(0,"div",41),w.Qb(1,"div",42),w.Qb(2,"h2"),w.Cc(3),w.ac(4,"translate"),w.Pb(),w.Mb(5,"br"),w.Qb(6,"a",43),w.Xb("click",(function(){return w.pc(t),w.Zb().popupSelberTag=!1})),w.Cc(7,"\xd7"),w.Pb(),w.Qb(8,"a"),w.Cc(9),w.ac(10,"translate"),w.ac(11,"translate"),w.ac(12,"translate"),w.Pb(),w.Mb(13,"br"),w.Mb(14,"br"),w.Qb(15,"button",44),w.Xb("click",(function(){return w.pc(t),w.Zb().popupSelberTag=!1})),w.Cc(16,"OK"),w.Pb(),w.Pb(),w.Pb()}if(2&t){const t=w.Zb();w.zb(3),w.Dc(w.bc(4,6,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PRUEF_D_SCHUETZEN")),w.zb(6),w.Gc("",w.bc(10,8,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SCHUETZE")," ",t.passeSelberTag," ",w.bc(11,10,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SELBER_TAG_PRUEFUNG1")," ",t.selberTagVeranstaltung," ",w.bc(12,12,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SELBER_TAG_PRUEFUNG2"),"")}}function te(t,e){if(1&t){const t=w.Rb();w.Qb(0,"div",41),w.Qb(1,"div",42),w.Qb(2,"h2"),w.Cc(3),w.ac(4,"translate"),w.Pb(),w.Mb(5,"br"),w.Qb(6,"a",43),w.Xb("click",(function(){return w.pc(t),w.Zb().popupAndererTag=!1})),w.Cc(7,"\xd7"),w.Pb(),w.Qb(8,"a"),w.Cc(9),w.ac(10,"translate"),w.ac(11,"translate"),w.ac(12,"translate"),w.ac(13,"translate"),w.Pb(),w.Mb(14,"br"),w.Mb(15,"br"),w.Qb(16,"button",44),w.Xb("click",(function(){return w.pc(t),w.Zb().popupAndererTag=!1})),w.Cc(17,"OK"),w.Pb(),w.Pb(),w.Pb()}if(2&t){const t=w.Zb();w.zb(3),w.Dc(w.bc(4,8,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PRUEF_D_SCHUETZEN")),w.zb(6),w.Hc("",w.bc(10,10,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SCHUETZE")," ",t.passeAndererTag," ",w.bc(11,12,"WKDURCHFUEHRUNG.SCHUSSZETTEL.ANDERER_TAG_PRUEFUNG1")," ",t.andererTagAnzahl," ",w.bc(12,14,"WKDURCHFUEHRUNG.SCHUSSZETTEL.ANDERER_TAG_PRUEFUNG2")," ",t.andererTagVeranstaltung.name," ",w.bc(13,16,"WKDURCHFUEHRUNG.SCHUSSZETTEL.ANDERER_TAG_PRUEFUNG3"),"")}}let ee=(()=>{class t{constructor(t,e,n,a,i,s,c,r,l,o,h,u,d){this.router=t,this.schusszettelService=e,this.ligatabelleService=n,this.matchProvider=a,this.route=i,this.notificationService=s,this.vereinDataProvider=c,this.dsbMannschaftDataProvider=r,this.passeDataProvider=l,this.wettkampfDataProvider=o,this.veranstaltungDataProvider=h,this.mannschaftsMitgliedDataProvider=u,this.onOfflineService=d,this.match1singlesatzpoints=[],this.match2singlesatzpoints=[],this.mannschaften=[],this.vereine=[],this.allPasse=[],this.matchAllPasse=new Array,this.selberWettkampftag=new Array,this.selberWettkampftagVeranstaltung=Array(),this.anzahlAnTagenMannschaft=new Array}ngOnInit(){this.match1=new T(null,null,null,1,1,1,1,[],0,0,null,null),this.match1.nr=1,this.match1.schuetzen=[],this.match1singlesatzpoints=[],this.match2=new T(null,null,null,1,1,1,1,[],0,0,null,null),this.match2.nr=1,this.match2.schuetzen=[],this.match2singlesatzpoints=[],this.dirtyFlag=!1,this.initSchuetzenMatch1(),this.initSchuetzenMatch2(),this.route.params.subscribe(t=>{if(!Object(E.c)(t.match1id)&&!Object(E.c)(t.match2id)){const e=t.match1id,n=t.match2id;this.notificationService.showNotification({id:"NOTIFICATION_SCHUSSZETTEL_LOADING",title:"WKDURCHFUEHRUNG.SCHUSSZETTEL.NOTIFICATION.LADEN.TITLE",description:"WKDURCHFUEHRUNG.SCHUSSZETTEL.NOTIFICATION.LADEN.DESCRIPTION",severity:R.f.INFO,origin:R.d.USER,userAction:R.h.PENDING}),this.schusszettelService.findMatches(e,n).then(t=>{if(this.match1=t.payload[0],this.match2=t.payload[1],0!=this.match1.schuetzen.length){if(this.match1.schuetzen.length>3)for(let t=this.match1.schuetzen.length;t>3;t--)this.match1.schuetzen.pop();for(let t=0;t<3;t++)if(this.match1.schuetzen[t].length>5&&0!=this.match1.schuetzen[t].length)for(let e=this.match1.schuetzen[t].length;e>5;e--)this.match1.schuetzen[t].pop()}if(0!=this.match2.schuetzen.length){if(this.match2.schuetzen.length>3)for(let t=this.match2.schuetzen.length;t>3;t--)this.match2.schuetzen.pop();for(let t=0;t<3;t++)if(this.match2.schuetzen[t].length>5&&0!=this.match1.schuetzen[t].length)for(let e=this.match2.schuetzen[t].length;e>5;e--)this.match2.schuetzen[t].pop()}console.log("match1",this.match1),console.log("match2",this.match2);let e=!0;this.match1.schuetzen.length<=0&&(this.initSchuetzenMatch1(),e=!1),this.match2.schuetzen.length<=0&&(this.initSchuetzenMatch2(),e=!1),e&&(this.initSumSatz(),this.setPoints()),this.wettkampfDataProvider.findAllowedMember(this.match1.wettkampfId,this.match1.mannschaftId,this.match2.mannschaftId).then(t=>{this.allowedMitglieder1=t,console.log("Allowed for match1: ",this.allowedMitglieder1),this.match1.wettkampfId===this.match2.wettkampfId&&(this.allowedMitglieder2=this.allowedMitglieder1,this.notificationService.discardNotification())}),this.match1.wettkampfId!==this.match2.wettkampfId&&this.wettkampfDataProvider.findAllowedMember(this.match2.wettkampfId,this.match1.mannschaftId,this.match2.mannschaftId).then(t=>{this.allowedMitglieder2=t,console.log("Allowed for match2: ",this.allowedMitglieder2),this.notificationService.discardNotification()}),this.onOfflineService.isOffline()&&this.notificationService.discardNotification()}).catch(t=>{console.error(t)})}})}onChange(t,e,n,a,i){const s=this["match"+e],c=s.schuetzen[n][a];let r=parseInt(t,10);r=r>=0?r:null,1===i?c.ringzahlPfeil1=r:c.ringzahlPfeil2=r,s.sumSatz[a]=this.getSumSatz(s,a),this.setPoints(),this.dirtyFlag=!0}onSchuetzeChange(t,e,n){return Object(r.a)(this,void 0,void 0,(function*(){const n=1===e?this.match1.mannschaftId:this.match2.mannschaftId;let a=!0,i=[],s=null;try{s=yield this.mannschaftsMitgliedDataProvider.findByTeamIdAndRueckennummer(n,t)}catch(c){a=!1}if(null!=s&&s.result===b.RequestResult.SUCCESS){const c=s.payload.dsbMitgliedId;console.log("DsbNummer for Mannschaftsmitglied in Mannschaft "+n+" and Rueckennummer "+t+" is "+c),i=1==e?this.allowedMitglieder1:this.allowedMitglieder2,i.includes(c)||(a=!1)}a||this.notificationService.showNotification({id:"NOTIFICATION_SCHUSSZETTEL_SCHUETZENNUMMER",title:"WKDURCHFUEHRUNG.SCHUSSZETTEL.NOTIFICATION.SCHUETZENNUMMER.TITLE",description:"WKDURCHFUEHRUNG.SCHUSSZETTEL.NOTIFICATION.SCHUETZENNUMMER.DESCRIPTION",severity:R.f.ERROR,origin:R.d.SYSTEM,type:R.g.OK,userAction:R.h.ACCEPTED})}))}onFehlerpunkteChange(t,e,n){const a=this["match"+e];let i=parseInt(t,10);i=i>=1?i:null,a.fehlerpunkte[n]=i,a.sumSatz[n]=this.getSumSatz(a,n),this.setPoints(),this.dirtyFlag=!0}getAllMannschaften(){this.dsbMannschaftDataProvider.findAll().then(t=>{this.mannschaften=t.payload})}getAllVerein(){this.vereinDataProvider.findAll().then(t=>{this.vereine=t.payload})}getAllPasse(){this.passeDataProvider.findAll().then(t=>{this.allPasse=t.payload})}getAllWettkaempfe(){this.wettkampfDataProvider.findAll().then(t=>{this.allWettkaempfe=t.payload})}maxMannschaftsId(){let t=this.mannschaften[0].id;return this.mannschaften.forEach(e=>{e.id>t&&(t=e.id)}),t}savepopSelberTag(){this.popupSelberTag=!0}savepopAndererTag(){this.popupAndererTag=!0}save(){return Object(r.a)(this,void 0,void 0,(function*(){let t=null,e=null;if(this.onOfflineService.isOffline()&&(yield this.matchProvider.getmatchoffline(this.match1.nr)).payload.forEach(n=>{n.mannschaftId===this.match1.mannschaftId?t=n:n.mannschaftId===this.match2.mannschaftId&&(e=n)}),this.match1.satzpunkte>7||this.match2.satzpunkte>7)this.notificationService.showNotification({id:"NOTIFICATION_SCHUSSZETTEL_ENTSCHIEDEN",title:"WKDURCHFUEHRUNG.SCHUSSZETTEL.NOTIFICATION.ENTSCHIEDEN.TITLE",description:"WKDURCHFUEHRUNG.SCHUSSZETTEL.NOTIFICATION.ENTSCHIEDEN.DESCRIPTION",severity:R.f.ERROR,origin:R.d.SYSTEM,type:R.g.OK,userAction:R.h.ACCEPTED});else if(null==this.match1.schuetzen[0][0].rueckennummer||null==this.match1.schuetzen[1][0].rueckennummer||null==this.match1.schuetzen[2][0].rueckennummer||null==this.match2.schuetzen[0][0].rueckennummer||null==this.match2.schuetzen[1][0].rueckennummer||null==this.match2.schuetzen[2][0].rueckennummer)this.notificationService.showNotification({id:"NOTIFICATION_SCHUSSZETTEL_SCHUETZENNUMMER",title:"WKDURCHFUEHRUNG.SCHUSSZETTEL.NOTIFICATION.SCHUETZENNUMMER.TITLE",description:"WKDURCHFUEHRUNG.SCHUSSZETTEL.NOTIFICATION.SCHUETZENNUMMER.DESCRIPTION",severity:R.f.ERROR,origin:R.d.SYSTEM,type:R.g.OK,userAction:R.h.ACCEPTED});else if(this.match1.schuetzen[0][0].rueckennummer===this.match1.schuetzen[1][0].rueckennummer||this.match1.schuetzen[1][0].rueckennummer===this.match1.schuetzen[2][0].rueckennummer||this.match1.schuetzen[2][0].rueckennummer===this.match1.schuetzen[0][0].rueckennummer||this.match2.schuetzen[0][0].rueckennummer===this.match2.schuetzen[1][0].rueckennummer||this.match2.schuetzen[1][0].rueckennummer===this.match2.schuetzen[2][0].rueckennummer||this.match2.schuetzen[2][0].rueckennummer===this.match2.schuetzen[0][0].rueckennummer)this.notificationService.showNotification({id:"NOTIFICATION_SCHUSSZETTEL_SCHUETZENNUMMER",title:"WKDURCHFUEHRUNG.SCHUSSZETTEL.NOTIFICATION.SCHUETZENEINDEUTIG.TITLE",description:"WKDURCHFUEHRUNG.SCHUSSZETTEL.NOTIFICATION.SCHUETZENEINDEUTIG.DESCRIPTION",severity:R.f.ERROR,origin:R.d.SYSTEM,type:R.g.OK,userAction:R.h.ACCEPTED});else{this.notificationService.showNotification({id:"NOTIFICATION_SCHUSSZETTEL_SPEICHERN",title:"wkdurchfuehrung.SCHUSSZETTEL.NOTIFICATION.SPEICHERN.TITLE",description:"wkdurchfuehrung.SCHUSSZETTEL.NOTIFICATION.SPEICHERN.DESCRIPTION",severity:R.f.INFO,origin:R.d.USER,userAction:R.h.PENDING});for(let t=0;t<3;t++)for(let e=1;e<5;e++)this.match1.schuetzen[t][e].lfdNr<=1&&(this.match1.schuetzen[t][e].lfdNr=e+1),this.match2.schuetzen[t][e].lfdNr<=1&&(this.match2.schuetzen[t][e].lfdNr=e+1),this.match1.schuetzen[t][e].dsbMitgliedId=this.match1.schuetzen[t][0].dsbMitgliedId,this.match2.schuetzen[t][e].dsbMitgliedId=this.match2.schuetzen[t][0].dsbMitgliedId,this.match1.schuetzen[t][e].rueckennummer=this.match1.schuetzen[t][0].rueckennummer,this.match2.schuetzen[t][e].rueckennummer=this.match2.schuetzen[t][0].rueckennummer;this.schusszettelService.create(this.match1,this.match2).then(t=>{this.match1=t.payload[0],this.match2=t.payload[1],this.ngOnInit(),this.notificationService.showNotification({id:"NOTIFICATION_SCHUSSZETTEL_ENTSCHIEDEN",title:"wkdurchfuehrung.SCHUSSZETTEL.NOTIFICATION.GESPEICHERT.TITLE",description:"wkdurchfuehrung.SCHUSSZETTEL.NOTIFICATION.GESPEICHERT.DESCRIPTION",severity:R.f.ERROR,origin:R.d.SYSTEM,type:R.g.OK,userAction:R.h.ACCEPTED})},t=>{console.error(t),this.notificationService.showNotification({id:"NOTIFICATION_SCHUSSZETTEL_ENTSCHIEDEN",title:"wkdurchfuehrung.SCHUSSZETTEL.NOTIFICATION.RUECKENNUMMERZUHOCH.TITLE",description:"wkdurchfuehrung.SCHUSSZETTEL.NOTIFICATION.RUECKENNUMMERZUHOCH.DESCRIPTION",severity:R.f.ERROR,origin:R.d.SYSTEM,type:R.g.OK,userAction:R.h.ACCEPTED}),this.notificationService.discardNotification()}),this.onOfflineService.isOffline()&&(yield this.ligatabelleService.updateLigatabelleVeranstaltung(this.match1,t,this.match2,e)),this.dirtyFlag=!1}}))}back(){if(!0===this.dirtyFlag){const t={id:"schusszettel-weiter",title:"wkdurchfuehrung.SCHUSSZETTEL.NOTIFICATION.ZURUECK.TITLE",description:"wkdurchfuehrung.SCHUSSZETTEL.NOTIFICATION.ZURUECK.DESCRIPTION",severity:R.f.QUESTION,origin:R.d.USER,type:R.g.YES_NO,userAction:R.h.PENDING};console.log("show notification"),this.notificationService.showNotification(t),console.log("notification.userAction before: "+t.userAction),this.notificationService.observeNotification("schusszettel-weiter").subscribe(e=>{console.log("observe notification"),e.userAction===R.h.ACCEPTED&&(console.log("accepted"),this.dirtyFlag=!1,console.log("Wettkampftag",this.match1.wettkampfTag),this.router.navigate(["/wkdurchfuehrung/"+this.match1.wettkampfId])),console.log("notification.userAction after: "+t.userAction)})}else console.log("Keine \xc4nderung"),console.log("Wettkampftag",this.match1.wettkampfTag),this.router.navigate(["/wkdurchfuehrung/"+this.match1.wettkampfId])}next(){if(!0===this.dirtyFlag){const t={id:"schusszettel_weiter",title:"wkdurchfuehrung.SCHUSSZETTEL.NOTIFICATION.WEITER.TITLE",description:"wkdurchfuehrung.SCHUSSZETTEL.NOTIFICATION.WEITER.DESCRIPTION",severity:R.f.QUESTION,origin:R.d.USER,type:R.g.YES_NO,userAction:R.h.PENDING};this.notificationService.observeNotification("schusszettel_weiter").subscribe(t=>{t.userAction===R.h.ACCEPTED&&(this.dirtyFlag=!1,this.matchProvider.pairToFollow(this.match2.id).then(t=>{2===t.payload.length&&this.router.navigate(["/wkdurchfuehrung/schusszettel/"+t.payload[0]+"/"+t.payload[1]])}))}),this.notificationService.showNotification(t)}else this.matchProvider.pairToFollow(this.match2.id).then(t=>{2===t.payload.length&&this.router.navigate(["/wkdurchfuehrung/schusszettel/"+t.payload[0]+"/"+t.payload[1]])})}previous(){if(!0===this.dirtyFlag){const t={id:"schusszettel_weiter",title:"wkdurchfuehrung.SCHUSSZETTEL.NOTIFICATION.WEITER.TITLE",description:"wkdurchfuehrung.SCHUSSZETTEL.NOTIFICATION.WEITER.DESCRIPTION",severity:R.f.QUESTION,origin:R.d.USER,type:R.g.YES_NO,userAction:R.h.PENDING};this.notificationService.observeNotification("schusszettel_weiter").subscribe(t=>{t.userAction===R.h.ACCEPTED&&(this.dirtyFlag=!1,this.matchProvider.previousPair(this.match1.id).then(t=>{2===t.payload.length&&this.router.navigate(["/wkdurchfuehrung/schusszettel/"+t.payload[0]+"/"+t.payload[1]])}))}),this.notificationService.showNotification(t)}else this.matchProvider.previousPair(this.match1.id).then(t=>{2===t.payload.length&&this.router.navigate(["/wkdurchfuehrung/schusszettel/"+t.payload[0]+"/"+t.payload[1]])})}trackByIndex(t,e){return t}initSchuetzenMatch1(){this.match1singlesatzpoints=[],this.match1.sumSatz=[];for(let t=0;t<5;t++)this.match1.sumSatz.push(0),this.match1singlesatzpoints.push(0);this.match1.schuetzen=[];for(let t=0;t<3;t++){this.match1.schuetzen.push(new Array);for(let e=0;e<5;e++)this.match1.schuetzen[t].push(new U(null,this.match1.id,this.match1.mannschaftId,this.match1.wettkampfId,this.match1.nr,e+1))}}initSchuetzenMatch2(){this.match2singlesatzpoints=[],this.match2.sumSatz=[];for(let t=0;t<5;t++)this.match2.sumSatz.push(0),this.match2singlesatzpoints.push(0);this.match2.schuetzen=[];for(let t=0;t<3;t++){this.match2.schuetzen.push(new Array);for(let e=0;e<5;e++)this.match2.schuetzen[t].push(new U(null,this.match2.id,this.match2.mannschaftId,this.match2.wettkampfId,this.match2.nr,e+1))}}getSumSatz(t,e){let n=0;for(const a of Object.keys(t.schuetzen))n+=t.schuetzen[a][e].ringzahlPfeil1,n+=t.schuetzen[a][e].ringzahlPfeil2,n>0&&null==t.schuetzen[a][e].ringzahlPfeil1&&(t.schuetzen[a][e].ringzahlPfeil1=0),n>0&&null==t.schuetzen[a][e].ringzahlPfeil2&&(t.schuetzen[a][e].ringzahlPfeil2=0);return n-=t.fehlerpunkte[e],n}setPoints(){"Liga kummulativ"===this.match1.wettkampfTyp?this.setKummulativePoints():this.setSatzPoints(),this.match1.satzpunkte>=6?(this.match1.matchpunkte=2,this.match2.matchpunkte=0):this.match2.satzpunkte>=6?(this.match1.matchpunkte=0,this.match2.matchpunkte=2):5===this.match2.satzpunkte&&5===this.match1.satzpunkte&&(this.match1.matchpunkte=1,this.match2.matchpunkte=1)}setSatzPoints(){let t=0,e=0;for(let n=0;n<5;n++)this.match1.sumSatz[n]>this.match2.sumSatz[n]?(t+=2,this.match1singlesatzpoints[n]=2,this.match2singlesatzpoints[n]=0):this.match1.sumSatz[n]<this.match2.sumSatz[n]?(e+=2,this.match1singlesatzpoints[n]=0,this.match2singlesatzpoints[n]=2):this.match1.sumSatz[n]===this.match2.sumSatz[n]&&this.match1.sumSatz[n]>0&&this.match2.sumSatz[n]>0&&(t++,e++,this.match1singlesatzpoints[n]=1,this.match2singlesatzpoints[n]=1);this.match1.satzpunkte=t,this.match2.satzpunkte=e,this.match1.matchpunkte=0,this.match2.matchpunkte=0}setKummulativePoints(){let t=0,e=0;for(let n=0;n<3;n++)t+=this.match1.sumSatz[n],e+=this.match2.sumSatz[n];t>e?(this.match1.satzpunkte=6,this.match2.satzpunkte=0):t<e&&(this.match1.satzpunkte=0,this.match2.satzpunkte=6)}initSumSatz(){for(let t=0;t<5;t++)this.match1.sumSatz[t]=this.getSumSatz(this.match1,t),this.match2.sumSatz[t]=this.getSumSatz(this.match2,t)}getSummeSchuetze(t,e){let n=0;const a=this["match"+e];for(const i of a.schuetzen[t])n+=i.ringzahlPfeil1+i.ringzahlPfeil2;return n}onButtonDownload(t){return(new b.UriBuilder).fromPath(D.a.backendBaseUrl).path("v1/download").path(t).path(this.match1.id+"/"+this.match2.id).build()}}return t.\u0275fac=function(e){return new(e||t)(w.Lb(s.c),w.Lb(It),w.Lb(Rt.a),w.Lb(H),w.Lb(s.a),w.Lb(R.e),w.Lb(Y.a),w.Lb($.a),w.Lb(L.a),w.Lb(p.a),w.Lb(m.a),w.Lb(zt.a),w.Lb(R.i))},t.\u0275cmp=w.Fb({type:t,selectors:[["bla-schusszettel"]],decls:300,vars:225,consts:[[1,"wettkaempfe","container"],[1,"match1","print"],[1,"row"],[1,"match_col-3"],[1,"mannschaften_col-3"],[1,"small_Table","col-6"],["id","punktetabelle",1,"table","table-responsive","thead-light","table-striped",2,"max-width","100%"],[4,"ngFor","ngForOf"],["readonly","","tabindex","-1","type","text",3,"value"],[1,"col-4","offset-9"],[1,"bigTable","col-9"],["id","schusstabelle",1,"table","table-hover","table-responsive","thead-light","table-striped",2,"width","100%"],["rowspan","2"],["colspan","2"],["ngFor","",3,"ngForOf"],[1,"col-2"],[1,"row",2,"margin-bottom","10px"],[1,"col-4"],["blaFehlerNumberOnly","",1,"fehlerfeld",3,"ngModel","ngModelChange"],[1,"print","signature","s1"],[1,"m1"],[1,"m2"],[1,"print"],[1,"match2","print"],["id","henlo",1,"match_col-3"],[1,"table","table-responsive","thead-light","table-striped",2,"width","100%"],[1,"table","table-hover","table-responsive","thead-light","table-striped",2,"width","100%"],[1,"col-sm-8"],[1,"btn","btn-primary","backButton",3,"click"],[1,"btn","btn-primary","saveButton",3,"click"],[1,"btn",3,"id","downloadUrl","fileName","disabled"],[1,"align-self-center"],[1,"btn","btn-primary","nextButton",3,"click"],["class","schuetze-popup",4,"ngIf"],[1,"print","signature"],[1,"schuetzensumme"],[4,"ngIf"],[1,"split"],["blaPfeilNumberOnly","","blaRingzahlTabIndexDirective","","type","text",3,"ngModel","ngModelChange"],["blaSchuetzeNumberOnly","","blaSchuetzenTabIndexDirective","","type","number",3,"ngModel","ngModelChange"],["readonly","","tabindex","-1","type","number",3,"value"],[1,"schuetze-popup"],[1,"popup"],[1,"close",3,"click"],["type","submit",1,"btn","btn-primary",3,"click"]],template:function(t,e){1&t&&(w.Qb(0,"div",0),w.Qb(1,"div",1),w.Qb(2,"div",2),w.Qb(3,"div",3),w.Qb(4,"h2"),w.Cc(5),w.Pb(),w.Qb(6,"h2"),w.Cc(7),w.ac(8,"translate"),w.Pb(),w.Pb(),w.Qb(9,"div",4),w.Qb(10,"h2"),w.Cc(11),w.Pb(),w.Qb(12,"h2"),w.Cc(13),w.ac(14,"translate"),w.Pb(),w.Qb(15,"h2"),w.Cc(16),w.Pb(),w.Pb(),w.Qb(17,"div",5),w.Qb(18,"table",6),w.Qb(19,"tr"),w.Ac(20,Qt,5,5,"td",7),w.Qb(21,"td"),w.Qb(22,"label"),w.Cc(23),w.ac(24,"translate"),w.Pb(),w.Mb(25,"input",8),w.Pb(),w.Qb(26,"td"),w.Qb(27,"label"),w.Cc(28),w.ac(29,"translate"),w.Pb(),w.Mb(30,"input",8),w.Pb(),w.Pb(),w.Qb(31,"tr"),w.Ac(32,Gt,2,1,"td",7),w.Qb(33,"td"),w.Mb(34,"input",8),w.Pb(),w.Qb(35,"td"),w.Mb(36,"input",8),w.Pb(),w.Pb(),w.Pb(),w.Pb(),w.Pb(),w.Qb(37,"div",2),w.Qb(38,"div",9),w.Cc(39),w.ac(40,"translate"),w.Pb(),w.Pb(),w.Qb(41,"div",2),w.Qb(42,"div",10),w.Qb(43,"table",11),w.Qb(44,"thead"),w.Qb(45,"tr"),w.Qb(46,"th",12),w.Cc(47),w.ac(48,"translate"),w.Pb(),w.Qb(49,"th",13),w.Cc(50),w.ac(51,"translate"),w.Pb(),w.Qb(52,"th",13),w.Cc(53),w.ac(54,"translate"),w.Pb(),w.Qb(55,"th",13),w.Cc(56),w.ac(57,"translate"),w.Pb(),w.Qb(58,"th",13),w.Cc(59),w.ac(60,"translate"),w.Pb(),w.Qb(61,"th",13),w.Cc(62),w.ac(63,"translate"),w.Pb(),w.Pb(),w.Qb(64,"tr"),w.Qb(65,"th"),w.Cc(66),w.ac(67,"translate"),w.Pb(),w.Qb(68,"th"),w.Cc(69),w.ac(70,"translate"),w.Pb(),w.Qb(71,"th"),w.Cc(72),w.ac(73,"translate"),w.Pb(),w.Qb(74,"th"),w.Cc(75),w.ac(76,"translate"),w.Pb(),w.Qb(77,"th"),w.Cc(78),w.ac(79,"translate"),w.Pb(),w.Qb(80,"th"),w.Cc(81),w.ac(82,"translate"),w.Pb(),w.Qb(83,"th"),w.Cc(84),w.ac(85,"translate"),w.Pb(),w.Qb(86,"th"),w.Cc(87),w.ac(88,"translate"),w.Pb(),w.Qb(89,"th"),w.Cc(90),w.ac(91,"translate"),w.Pb(),w.Qb(92,"th"),w.Cc(93),w.ac(94,"translate"),w.Pb(),w.Pb(),w.Pb(),w.Ac(95,Bt,5,3,"ng-template",14),w.Pb(),w.Pb(),w.Qb(96,"div",15),w.Qb(97,"div",16),w.Qb(98,"label",17),w.Cc(99),w.ac(100,"translate"),w.Pb(),w.Qb(101,"div",17),w.Qb(102,"input",18),w.Xb("ngModelChange",(function(t){return e.onFehlerpunkteChange(t,1,0)}))("ngModelChange",(function(t){return e.match1.fehlerpunkte[0]=t})),w.Pb(),w.Pb(),w.Pb(),w.Qb(103,"div",16),w.Qb(104,"label",17),w.Cc(105),w.ac(106,"translate"),w.Pb(),w.Qb(107,"div",17),w.Qb(108,"input",18),w.Xb("ngModelChange",(function(t){return e.onFehlerpunkteChange(t,1,1)}))("ngModelChange",(function(t){return e.match1.fehlerpunkte[1]=t})),w.Pb(),w.Pb(),w.Pb(),w.Qb(109,"div",16),w.Qb(110,"label",17),w.Cc(111),w.ac(112,"translate"),w.Pb(),w.Qb(113,"div",17),w.Qb(114,"input",18),w.Xb("ngModelChange",(function(t){return e.onFehlerpunkteChange(t,1,2)}))("ngModelChange",(function(t){return e.match1.fehlerpunkte[2]=t})),w.Pb(),w.Pb(),w.Pb(),w.Qb(115,"div",16),w.Qb(116,"label",17),w.Cc(117),w.ac(118,"translate"),w.Pb(),w.Qb(119,"div",17),w.Qb(120,"input",18),w.Xb("ngModelChange",(function(t){return e.onFehlerpunkteChange(t,1,3)}))("ngModelChange",(function(t){return e.match1.fehlerpunkte[3]=t})),w.Pb(),w.Pb(),w.Pb(),w.Qb(121,"div",16),w.Qb(122,"label",17),w.Cc(123),w.ac(124,"translate"),w.Pb(),w.Qb(125,"div",17),w.Qb(126,"input",18),w.Xb("ngModelChange",(function(t){return e.onFehlerpunkteChange(t,1,4)}))("ngModelChange",(function(t){return e.match1.fehlerpunkte[4]=t})),w.Pb(),w.Pb(),w.Pb(),w.Pb(),w.Pb(),w.Pb(),w.Qb(127,"div",19),w.Qb(128,"div",20),w.Qb(129,"h1"),w.Cc(130),w.Pb(),w.Qb(131,"p"),w.Cc(132),w.ac(133,"translate"),w.Pb(),w.Pb(),w.Qb(134,"div",21),w.Qb(135,"h1"),w.Cc(136),w.Pb(),w.Qb(137,"p"),w.Cc(138),w.ac(139,"translate"),w.Pb(),w.Pb(),w.Pb(),w.Mb(140,"hr",22),w.Qb(141,"div",23),w.Qb(142,"div",2),w.Qb(143,"div",24),w.Qb(144,"h2"),w.Cc(145),w.Pb(),w.Qb(146,"h2"),w.Cc(147),w.ac(148,"translate"),w.Pb(),w.Pb(),w.Qb(149,"div",4),w.Qb(150,"h2"),w.Cc(151),w.Pb(),w.Qb(152,"h2"),w.Cc(153),w.ac(154,"translate"),w.Pb(),w.Qb(155,"h2"),w.Cc(156),w.Pb(),w.Pb(),w.Qb(157,"div",5),w.Qb(158,"table",25),w.Qb(159,"tr"),w.Ac(160,xt,5,5,"td",7),w.Qb(161,"td"),w.Qb(162,"label"),w.Cc(163),w.ac(164,"translate"),w.Pb(),w.Mb(165,"input",8),w.Pb(),w.Qb(166,"td"),w.Qb(167,"label"),w.Cc(168),w.ac(169,"translate"),w.Pb(),w.Mb(170,"input",8),w.Pb(),w.Pb(),w.Qb(171,"tr"),w.Ac(172,Vt,2,1,"td",7),w.Qb(173,"td"),w.Mb(174,"input",8),w.Pb(),w.Qb(175,"td"),w.Mb(176,"input",8),w.Pb(),w.Pb(),w.Pb(),w.Pb(),w.Pb(),w.Qb(177,"div",2),w.Qb(178,"div",9),w.Cc(179),w.ac(180,"translate"),w.Pb(),w.Pb(),w.Qb(181,"div",2),w.Qb(182,"div",10),w.Qb(183,"table",26),w.Qb(184,"thead"),w.Qb(185,"tr"),w.Qb(186,"th",12),w.Cc(187),w.ac(188,"translate"),w.Pb(),w.Qb(189,"th",13),w.Cc(190),w.ac(191,"translate"),w.Pb(),w.Qb(192,"th",13),w.Cc(193),w.ac(194,"translate"),w.Pb(),w.Qb(195,"th",13),w.Cc(196),w.ac(197,"translate"),w.Pb(),w.Qb(198,"th",13),w.Cc(199),w.ac(200,"translate"),w.Pb(),w.Qb(201,"th",13),w.Cc(202),w.ac(203,"translate"),w.Pb(),w.Pb(),w.Qb(204,"tr"),w.Qb(205,"th"),w.Cc(206),w.ac(207,"translate"),w.Pb(),w.Qb(208,"th"),w.Cc(209),w.ac(210,"translate"),w.Pb(),w.Qb(211,"th"),w.Cc(212),w.ac(213,"translate"),w.Pb(),w.Qb(214,"th"),w.Cc(215),w.ac(216,"translate"),w.Pb(),w.Qb(217,"th"),w.Cc(218),w.ac(219,"translate"),w.Pb(),w.Qb(220,"th"),w.Cc(221),w.ac(222,"translate"),w.Pb(),w.Qb(223,"th"),w.Cc(224),w.ac(225,"translate"),w.Pb(),w.Qb(226,"th"),w.Cc(227),w.ac(228,"translate"),w.Pb(),w.Qb(229,"th"),w.Cc(230),w.ac(231,"translate"),w.Pb(),w.Qb(232,"th"),w.Cc(233),w.ac(234,"translate"),w.Pb(),w.Pb(),w.Pb(),w.Ac(235,$t,5,3,"ng-template",14),w.Pb(),w.Pb(),w.Qb(236,"div",15),w.Qb(237,"div",16),w.Qb(238,"label",17),w.Cc(239),w.ac(240,"translate"),w.Pb(),w.Qb(241,"div",17),w.Qb(242,"input",18),w.Xb("ngModelChange",(function(t){return e.onFehlerpunkteChange(t,2,0)}))("ngModelChange",(function(t){return e.match2.fehlerpunkte[0]=t})),w.Pb(),w.Pb(),w.Pb(),w.Qb(243,"div",16),w.Qb(244,"label",17),w.Cc(245),w.ac(246,"translate"),w.Pb(),w.Qb(247,"div",17),w.Qb(248,"input",18),w.Xb("ngModelChange",(function(t){return e.onFehlerpunkteChange(t,2,1)}))("ngModelChange",(function(t){return e.match2.fehlerpunkte[1]=t})),w.Pb(),w.Pb(),w.Pb(),w.Qb(249,"div",16),w.Qb(250,"label",17),w.Cc(251),w.ac(252,"translate"),w.Pb(),w.Qb(253,"div",17),w.Qb(254,"input",18),w.Xb("ngModelChange",(function(t){return e.onFehlerpunkteChange(t,2,2)}))("ngModelChange",(function(t){return e.match2.fehlerpunkte[2]=t})),w.Pb(),w.Pb(),w.Pb(),w.Qb(255,"div",16),w.Qb(256,"label",17),w.Cc(257),w.ac(258,"translate"),w.Pb(),w.Qb(259,"div",17),w.Qb(260,"input",18),w.Xb("ngModelChange",(function(t){return e.onFehlerpunkteChange(t,2,3)}))("ngModelChange",(function(t){return e.match2.fehlerpunkte[3]=t})),w.Pb(),w.Pb(),w.Pb(),w.Qb(261,"div",16),w.Qb(262,"label",17),w.Cc(263),w.ac(264,"translate"),w.Pb(),w.Qb(265,"div",17),w.Qb(266,"input",18),w.Xb("ngModelChange",(function(t){return e.onFehlerpunkteChange(t,2,4)}))("ngModelChange",(function(t){return e.match2.fehlerpunkte[4]=t})),w.Pb(),w.Pb(),w.Pb(),w.Pb(),w.Pb(),w.Pb(),w.Qb(267,"div",2),w.Qb(268,"div",27),w.Qb(269,"button",28),w.Xb("click",(function(){return e.back()})),w.Cc(270),w.ac(271,"translate"),w.Pb(),w.Qb(272,"button",29),w.Xb("click",(function(){return e.save()})),w.Cc(273),w.ac(274,"translate"),w.Pb(),w.Qb(275,"bla-download-button",30),w.Cc(276),w.ac(277,"translate"),w.Pb(),w.Pb(),w.Qb(278,"div",31),w.Qb(279,"button",32),w.Xb("click",(function(){return e.previous()})),w.Cc(280),w.ac(281,"translate"),w.Pb(),w.Qb(282,"button",32),w.Xb("click",(function(){return e.next()})),w.Cc(283),w.ac(284,"translate"),w.Pb(),w.Pb(),w.Pb(),w.Ac(285,Jt,17,14,"div",33),w.Ac(286,te,18,18,"div",33),w.Qb(287,"div",34),w.Qb(288,"div",20),w.Qb(289,"h1"),w.Cc(290),w.Pb(),w.Qb(291,"p"),w.Cc(292),w.ac(293,"translate"),w.Pb(),w.Pb(),w.Qb(294,"div",21),w.Qb(295,"h1"),w.Cc(296),w.Pb(),w.Qb(297,"p"),w.Cc(298),w.ac(299,"translate"),w.Pb(),w.Pb(),w.Pb(),w.Pb()),2&t&&(w.zb(5),w.Dc(e.match1.mannschaftName),w.zb(2),w.Fc("",e.match1.nr,". ",w.bc(8,103,"WKDURCHFUEHRUNG.SCHUSSZETTEL.MATCH"),""),w.zb(4),w.Dc(e.match1.mannschaftName),w.zb(2),w.Dc(w.bc(14,105,"WKDURCHFUEHRUNG.SCHUSSZETTEL.GEGEN")),w.zb(3),w.Dc(e.match2.mannschaftName),w.zb(4),w.fc("ngForOf",e.match1singlesatzpoints),w.zb(3),w.Dc(w.bc(24,107,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SUMME")),w.zb(2),w.fc("value",e.match1.satzpunkte),w.zb(3),w.Dc(w.bc(29,109,"WKDURCHFUEHRUNG.SCHUSSZETTEL.MATCH")),w.zb(2),w.fc("value",e.match1.matchpunkte),w.zb(2),w.fc("ngForOf",e.match2singlesatzpoints),w.zb(2),w.fc("value",e.match2.satzpunkte),w.zb(2),w.fc("value",e.match2.matchpunkte),w.zb(3),w.Dc(w.bc(40,111,"WKDURCHFUEHRUNG.SCHUSSZETTEL.FEHLERPUNKTE")),w.zb(8),w.Dc(w.bc(48,113,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SCHUETZE")),w.zb(3),w.Ec("1. ",w.bc(51,115,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ_PRO_PFEIL"),""),w.zb(3),w.Ec("2. ",w.bc(54,117,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ_PRO_PFEIL"),""),w.zb(3),w.Ec("3. ",w.bc(57,119,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ_PRO_PFEIL"),""),w.zb(3),w.Ec("4. ",w.bc(60,121,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ_PRO_PFEIL"),""),w.zb(3),w.Ec("5. ",w.bc(63,123,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ_PRO_PFEIL"),""),w.zb(4),w.Ec("",w.bc(67,125,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 1"),w.zb(3),w.Ec("",w.bc(70,127,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 2"),w.zb(3),w.Ec("",w.bc(73,129,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 1"),w.zb(3),w.Ec("",w.bc(76,131,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 2"),w.zb(3),w.Ec("",w.bc(79,133,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 1"),w.zb(3),w.Ec("",w.bc(82,135,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 2"),w.zb(3),w.Ec("",w.bc(85,137,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 1"),w.zb(3),w.Ec("",w.bc(88,139,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 2"),w.zb(3),w.Ec("",w.bc(91,141,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 1"),w.zb(3),w.Ec("",w.bc(94,143,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 2"),w.zb(2),w.fc("ngForOf",e.match1.schuetzen),w.zb(4),w.Ec("",w.bc(100,145,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ")," 1"),w.zb(3),w.fc("ngModel",e.match1.fehlerpunkte[0]),w.zb(3),w.Ec("",w.bc(106,147,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ")," 2"),w.zb(3),w.fc("ngModel",e.match1.fehlerpunkte[1]),w.zb(3),w.Ec("",w.bc(112,149,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ")," 3"),w.zb(3),w.fc("ngModel",e.match1.fehlerpunkte[2]),w.zb(3),w.Ec("",w.bc(118,151,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ")," 4"),w.zb(3),w.fc("ngModel",e.match1.fehlerpunkte[3]),w.zb(3),w.Ec("",w.bc(124,153,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ")," 5"),w.zb(3),w.fc("ngModel",e.match1.fehlerpunkte[4]),w.zb(4),w.Dc(e.match2.mannschaftName),w.zb(2),w.Dc(w.bc(133,155,"WKDURCHFUEHRUNG.SCHUSSZETTEL.UNTERSCHRIFT")),w.zb(4),w.Dc(e.match1.mannschaftName),w.zb(2),w.Dc(w.bc(139,157,"WKDURCHFUEHRUNG.SCHUSSZETTEL.UNTERSCHRIFT")),w.zb(7),w.Dc(e.match2.mannschaftName),w.zb(2),w.Fc("",e.match2.nr,". ",w.bc(148,159,"WKDURCHFUEHRUNG.SCHUSSZETTEL.MATCH"),""),w.zb(4),w.Dc(e.match1.mannschaftName),w.zb(2),w.Dc(w.bc(154,161,"WKDURCHFUEHRUNG.SCHUSSZETTEL.GEGEN")),w.zb(3),w.Dc(e.match2.mannschaftName),w.zb(4),w.fc("ngForOf",e.match1singlesatzpoints),w.zb(3),w.Dc(w.bc(164,163,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SUMME")),w.zb(2),w.fc("value",e.match1.satzpunkte),w.zb(3),w.Dc(w.bc(169,165,"WKDURCHFUEHRUNG.SCHUSSZETTEL.MATCH")),w.zb(2),w.fc("value",e.match1.matchpunkte),w.zb(2),w.fc("ngForOf",e.match2singlesatzpoints),w.zb(2),w.fc("value",e.match2.satzpunkte),w.zb(2),w.fc("value",e.match2.matchpunkte),w.zb(3),w.Dc(w.bc(180,167,"WKDURCHFUEHRUNG.SCHUSSZETTEL.FEHLERPUNKTE")),w.zb(8),w.Dc(w.bc(188,169,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SCHUETZE")),w.zb(3),w.Ec("1. ",w.bc(191,171,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ_PRO_PFEIL"),""),w.zb(3),w.Ec("2. ",w.bc(194,173,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ_PRO_PFEIL"),""),w.zb(3),w.Ec("3. ",w.bc(197,175,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ_PRO_PFEIL"),""),w.zb(3),w.Ec("4. ",w.bc(200,177,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ_PRO_PFEIL"),""),w.zb(3),w.Ec("5. ",w.bc(203,179,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ_PRO_PFEIL"),""),w.zb(4),w.Ec("",w.bc(207,181,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 1"),w.zb(3),w.Ec("",w.bc(210,183,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 2"),w.zb(3),w.Ec("",w.bc(213,185,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 1"),w.zb(3),w.Ec("",w.bc(216,187,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 2"),w.zb(3),w.Ec("",w.bc(219,189,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 1"),w.zb(3),w.Ec("",w.bc(222,191,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 2"),w.zb(3),w.Ec("",w.bc(225,193,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 1"),w.zb(3),w.Ec("",w.bc(228,195,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 2"),w.zb(3),w.Ec("",w.bc(231,197,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 1"),w.zb(3),w.Ec("",w.bc(234,199,"WKDURCHFUEHRUNG.SCHUSSZETTEL.PFEIL")," 2"),w.zb(2),w.fc("ngForOf",e.match2.schuetzen),w.zb(4),w.Ec("",w.bc(240,201,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ")," 1"),w.zb(3),w.fc("ngModel",e.match2.fehlerpunkte[0]),w.zb(3),w.Ec("",w.bc(246,203,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ")," 2"),w.zb(3),w.fc("ngModel",e.match2.fehlerpunkte[1]),w.zb(3),w.Ec("",w.bc(252,205,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ")," 3"),w.zb(3),w.fc("ngModel",e.match2.fehlerpunkte[2]),w.zb(3),w.Ec("",w.bc(258,207,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ")," 4"),w.zb(3),w.fc("ngModel",e.match2.fehlerpunkte[3]),w.zb(3),w.Ec("",w.bc(264,209,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SATZ")," 5"),w.zb(3),w.fc("ngModel",e.match2.fehlerpunkte[4]),w.zb(4),w.Ec("",w.bc(271,211,"WKDURCHFUEHRUNG.SCHUSSZETTEL.ZURUECK")," "),w.zb(3),w.Ec("",w.bc(274,213,"WKDURCHFUEHRUNG.SCHUSSZETTEL.SPEICHERN")," "),w.zb(2),w.fc("id","downloadMatchSchusszettel")("downloadUrl",e.onButtonDownload("pdf/schusszettel_matches"))("fileName","match_schusszettel.pdf")("disabled",!1),w.zb(1),w.Ec("",w.bc(277,215,"WKDURCHFUEHRUNG.SCHUSSZETTEL.DRUCKEN")," "),w.zb(4),w.Ec("",w.bc(281,217,"WKDURCHFUEHRUNG.SCHUSSZETTEL.VORHERIGES_MATCH")," "),w.zb(3),w.Ec("",w.bc(284,219,"WKDURCHFUEHRUNG.SCHUSSZETTEL.NAECHSTES_MATCH")," "),w.zb(2),w.fc("ngIf",e.popupSelberTag),w.zb(1),w.fc("ngIf",e.popupAndererTag),w.zb(4),w.Dc(e.match2.mannschaftName),w.zb(2),w.Dc(w.bc(293,221,"WKDURCHFUEHRUNG.SCHUSSZETTEL.UNTERSCHRIFT")),w.zb(4),w.Dc(e.match1.mannschaftName),w.zb(2),w.Dc(w.bc(299,223,"WKDURCHFUEHRUNG.SCHUSSZETTEL.UNTERSCHRIFT")))},directives:[a.s,i.c,Mt,i.n,i.q,wt.a,a.t,vt,Lt,i.t,Ot,Ft],pipes:[St.d],styles:["input[_ngcontent-%COMP%], label[_ngcontent-%COMP%]{display:block}input[_ngcontent-%COMP%]::-webkit-inner-spin-button, input[_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[_ngcontent-%COMP%]{height:55px;width:55px;-moz-appearance:textfield;font-size:30px;text-align:center}input[_ngcontent-%COMP%]:focus{box-shadow:0 0 8px 0 #057aff}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{alignment:center;text-align:center;margin:10px;font-size:10px;padding:5px}td[_ngcontent-%COMP%]{font-size:16px}label[_ngcontent-%COMP%]{font-size:10px}.split[_ngcontent-%COMP%]{border-left:3px solid #4a4a4a}.match1[_ngcontent-%COMP%]{margin-top:20px}.match2[_ngcontent-%COMP%]{margin-top:-150px;margin-bottom:20px}.match1[_ngcontent-%COMP%], .match2[_ngcontent-%COMP%]{border:2px solid rgba(0,0,0,.1)}.schuetzensumme[_ngcontent-%COMP%]{font-size:30px}.btn[_ngcontent-%COMP%]{margin:0 15px 20px 20px}.signature[_ngcontent-%COMP%], hr[_ngcontent-%COMP%]{visibility:hidden}.match[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2vw}.mannschaften_col-3[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .match[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1vw}.mannschaften_col-3[_ngcontent-%COMP%]{max-width:16em;min-width:8em;margin-left:1em}.henlo.match_col-3[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1vw}.match_col-3[_ngcontent-%COMP%]{max-width:17em;min-width:8em;margin-left:1.5em}@media print{input[_ngcontent-%COMP%]{border:2px solid #dee2e6;height:45px;width:45px;font-size:25px}h1[_ngcontent-%COMP%]{font-size:10px!important}h3[_ngcontent-%COMP%]{font-size:2vm}.match1[_ngcontent-%COMP%]{margin-bottom:1cm}.match2[_ngcontent-%COMP%]{margin-top:1cm}.m1[_ngcontent-%COMP%], .m2[_ngcontent-%COMP%]{float:left}.m2[_ngcontent-%COMP%]{margin-left:20%}.signature[_ngcontent-%COMP%]{visibility:visible;margin-top:-2cm;margin-bottom:1cm;border-bottom:1px solid #000;display:inline-block;width:90%}.signature[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:1cm;margin-bottom:.5cm}.s1[_ngcontent-%COMP%]{margin-top:.5cm;margin-bottom:-2cm}hr[_ngcontent-%COMP%]{visibility:visible;width:100%;height:5px;border-style:dotted;size:1px;background:#dee2e6;margin-top:2.5cm;margin-bottom:.5cm}}.fehlerfeld[_ngcontent-%COMP%]{margin-left:-26px}.schuetze-popup[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;left:0;right:0;background:rgba(0,0,0,.7);transition:opacity;visibility:visible;opacity:1}.popup[_ngcontent-%COMP%]{margin:70px auto;padding:20px;background:#fff;border-radius:5px;width:30%;height:auto;position:relative;transition:all 5s ease-in-out}.popup[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0;color:#333;font-family:Tahoma,Arial,sans-serif}.popup[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{position:absolute;top:20px;right:30px;transition:all .2s;font-size:30px;font-weight:700;text-decoration:none;color:#333}.popup[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]:hover{color:#02bdd5;cursor:pointer}"]}),t})(),ne=(()=>{class t extends b.DataProviderService{constructor(t){super(),this.restClient=t,this.serviceSubUrl="v1/passen"}get(t){return new Promise((e,n)=>{this.restClient.GET((new b.UriBuilder).fromPath(this.getUrl()).path(t).build()).then(t=>{const n=N.passeToDO(t);e({result:b.RequestResult.SUCCESS,payload:n})},t=>{n(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})})})}create(t){const e=N.passeToDTO(t);return new Promise((t,n)=>{this.restClient.POST(this.getUrl(),e).then(e=>{const n=N.passeToDO(e);t({result:b.RequestResult.SUCCESS,payload:n})},t=>{n(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})})})}update(t){const e=N.passeToDTO(t);return new Promise((t,n)=>{this.restClient.PUT(this.getUrl(),e).then(e=>{const n=N.passeToDO(e);t({result:b.RequestResult.SUCCESS,payload:n})},t=>{n(0===t.status?{result:b.RequestResult.CONNECTION_PROBLEM}:{result:b.RequestResult.FAILURE})})})}}return t.\u0275fac=function(e){return new(e||t)(w.Ub(b.RestClient))},t.\u0275prov=w.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var ae=n("S0PF"),ie=n("mwxE"),se=n("6NWb");function ce(t,e){if(1&t){const t=w.Rb();w.Qb(0,"button",11),w.Xb("click",(function(){w.pc(t);const e=w.Zb().$implicit;return w.Zb().updateSessionWithoutTokenGeneration(e.scheibenNr)})),w.Mb(1,"fa-icon",12),w.Pb()}2&t&&(w.zb(1),w.fc("icon","trash"))}function re(t,e){if(1&t){const t=w.Rb();w.Qb(0,"button",13),w.Xb("click",(function(){w.pc(t);const e=w.Zb().$implicit;return w.Zb().updateSession(e.scheibenNr)})),w.Mb(1,"fa-icon",12),w.Pb()}2&t&&(w.zb(1),w.fc("icon","plus-circle"))}function le(t,e){if(1&t&&(w.Qb(0,"label"),w.Cc(1),w.Pb()),2&t){const t=w.Zb().$implicit;w.zb(1),w.Dc(t.accessToken)}}function oe(t,e){if(1&t&&(w.Qb(0,"tr"),w.Qb(1,"td"),w.Qb(2,"span",6),w.Cc(3),w.Pb(),w.Pb(),w.Qb(4,"td"),w.Qb(5,"span",7),w.Cc(6),w.Pb(),w.Pb(),w.Qb(7,"td"),w.Ac(8,ce,2,1,"button",8),w.Ac(9,re,2,1,"button",9),w.Pb(),w.Qb(10,"td"),w.Ac(11,le,2,1,"label",10),w.Pb(),w.Pb()),2&t){const t=e.$implicit;w.zb(3),w.Dc(t.scheibenNr),w.zb(2),w.Db("badge-danger",!t.isActive)("badge-success",t.isActive),w.zb(1),w.Ec(" ",t.isActive?"Aktiv":"Nicht aktiv"," "),w.zb(2),w.fc("ngIf",t.isActive),w.zb(1),w.fc("ngIf",!t.isActive),w.zb(2),w.fc("ngIf",t.isActive)}}const he=["[]","null","undefined"];let ue=(()=>{class t{constructor(t,e,n){this.route=t,this.router=e,this.tabletSessionService=n,this.currentDeviceIsActive=!1,this.accessToken=""}ngOnInit(){this.route.params.subscribe(t=>{if(!Object(E.c)(t.wettkampfId)){const e=t.wettkampfId;this.tabletSessionService.findAllTabletSessions(e).then(t=>{this.sessions=t.payload,this.setActiveSession(),this.setTabletEingabeRoute(),this.accessToken=this.currentSession.accessToken.toString()},t=>{console.error(t),this.sessions=[];for(let n=0;n<8;n++)this.sessions.push(new ae.a(n+1,parseInt(e,10),!1));this.setActiveSession()})}})}updateSession(t){const e=this.sessions[t-1];e.isActive=!e.isActive,this.storeCurrentSession(e),this.tabletSessionService.update(e).then(e=>{this.sessions[t-1]=this.currentSession=e.payload,this.storeCurrentSession(this.currentSession),this.accessToken=this.currentSession.accessToken.toString(),this.setTabletEingabeRoute(),this.currentDeviceIsActive&&this.currentSession&&this.currentSession.otherMatchId&&this.router.navigate([this.tabletEingabeRoute])},t=>{console.log(t)})}updateSessionWithoutTokenGeneration(t){const e=this.sessions[t-1];e.isActive=!e.isActive,this.storeCurrentSession(e),this.tabletSessionService.updateWithoutTokenCreation(e).then(e=>{this.sessions[t-1]=this.currentSession=e.payload,this.storeCurrentSession(this.currentSession),this.accessToken="",this.setTabletEingabeRoute(),this.currentDeviceIsActive&&this.currentSession&&this.currentSession.otherMatchId&&this.router.navigate([this.tabletEingabeRoute])},t=>{console.log(t)})}setActiveSession(){const t=localStorage.getItem("tabletSession");this.currentDeviceIsActive=Boolean(t)&&he.indexOf(t)<0,this.currentDeviceIsActive&&(this.currentSession=JSON.parse(t),this.sessions[this.currentSession.scheibenNr-1]=this.currentSession)}storeCurrentSession(t){t.isActive?(localStorage.setItem("tabletSession",JSON.stringify(t)),this.currentDeviceIsActive=!0):(localStorage.removeItem("tabletSession"),this.currentDeviceIsActive=!1)}setTabletEingabeRoute(){this.currentSession&&(this.tabletEingabeRoute="/"+this.currentSession.matchID+"/"+this.currentSession.otherMatchId+"/tablet")}canNavigateToEingabe(t){return this.currentDeviceIsActive&&this.currentSession&&this.currentSession.otherMatchId&&this.currentSession.scheibenNr===t.scheibenNr}}return t.\u0275fac=function(e){return new(e||t)(w.Lb(s.a),w.Lb(s.c),w.Lb(ie.a))},t.\u0275cmp=w.Fb({type:t,selectors:[["bla-tablet-admin"]],decls:20,vars:16,consts:[[1,"container"],[1,"mb-4","mt-3"],[1,"table-responsive"],[1,"table"],[2,"width","25%"],[4,"ngFor","ngForOf"],[1,"h4","text-secondary","text-center","m-0","p-0"],[1,"badge"],["class","btn btn-danger",3,"click",4,"ngIf"],["class","btn btn-success",3,"click",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-danger",3,"click"],[3,"icon"],[1,"btn","btn-success",3,"click"]],template:function(t,e){1&t&&(w.Qb(0,"div",0),w.Qb(1,"h2",1),w.Cc(2),w.ac(3,"translate"),w.Pb(),w.Qb(4,"div",2),w.Qb(5,"table",3),w.Qb(6,"tr"),w.Qb(7,"th",4),w.Cc(8),w.ac(9,"translate"),w.Pb(),w.Qb(10,"th",4),w.Cc(11),w.ac(12,"translate"),w.Pb(),w.Qb(13,"th",4),w.Cc(14),w.ac(15,"translate"),w.Pb(),w.Qb(16,"th",4),w.Cc(17),w.ac(18,"translate"),w.Pb(),w.Pb(),w.Ac(19,oe,12,9,"tr",5),w.Pb(),w.Pb(),w.Pb()),2&t&&(w.zb(2),w.Dc(w.bc(3,6,"WKDURCHFUEHRUNG.TABLET_ADMIN.VERWALTUNG")),w.zb(6),w.Dc(w.bc(9,8,"WKDURCHFUEHRUNG.TABLET_ADMIN.SCHEIBE")),w.zb(3),w.Dc(w.bc(12,10,"WKDURCHFUEHRUNG.TABLET_ADMIN.STATUS")),w.zb(3),w.Dc(w.bc(15,12,"WKDURCHFUEHRUNG.TABLET_ADMIN.AKTIONEN")),w.zb(3),w.Dc(w.bc(18,14,"WKDURCHFUEHRUNG.TABLET_ADMIN.ACCESS_TOKEN")),w.zb(2),w.fc("ngForOf",e.sessions))},directives:[a.s,a.t,se.b],pipes:[St.d],styles:["input[_ngcontent-%COMP%], label[_ngcontent-%COMP%]{display:block}input[_ngcontent-%COMP%]::-webkit-inner-spin-button, input[_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{alignment:center;text-align:center}"]}),t})();function de(t,e){if(1&t){const t=w.Rb();w.Qb(0,"div",14),w.Qb(1,"label",15),w.Cc(2),w.ac(3,"translate"),w.Pb(),w.Qb(4,"input",16),w.Xb("ngModelChange",(function(n){w.pc(t);const a=e.index;return w.Zb(3).schuetzen[a].schuetzeNr=n})),w.Pb(),w.Pb()}if(2&t){const t=e.index,n=w.Zb(3);w.zb(1),w.fc("for","schuetze"+t+"1Nummer"),w.zb(1),w.Fc("",t+1,". ",w.bc(3,6,"WKDURCHFUEHRUNG.TABLET_INPUT.SCHUETZE"),""),w.zb(2),w.fc("ngModel",n.schuetzen[t].schuetzeNr)("id","schuetze"+t+"1Nummer")("tabindex",t+1)}}function be(t,e){if(1&t){const t=w.Rb();w.Qb(0,"div",3),w.Qb(1,"h2",8),w.Cc(2),w.ac(3,"translate"),w.Pb(),w.Pb(),w.Qb(4,"div",9),w.Qb(5,"div",10),w.Ac(6,de,5,8,"ng-template",11),w.Pb(),w.Pb(),w.Qb(7,"div",12),w.Qb(8,"button",13),w.Xb("click",(function(){return w.pc(t),w.Zb(2).submitSchuetzenNr()})),w.Cc(9),w.ac(10,"translate"),w.Pb(),w.Pb()}if(2&t){const t=w.Zb(2);w.zb(2),w.Dc(w.bc(3,4,"WKDURCHFUEHRUNG.TABLET_INPUT.SCHUETZEN_NUMMERN")),w.zb(4),w.fc("ngForOf",t.schuetzen),w.zb(2),w.fc("disabled",!t.hasValidSchuetzenNr()),w.zb(1),w.Ec(" ",w.bc(10,6,"WKDURCHFUEHRUNG.TABLET_INPUT.SAVE")," ")}}function fe(t,e){if(1&t){const t=w.Rb();w.Qb(0,"input",26),w.Xb("ngModelChange",(function(e){w.pc(t);const n=w.Zb().$implicit;return w.Zb(3).onChange(e,1,n)}))("ngModelChange",(function(e){w.pc(t);const n=w.Zb().$implicit,a=w.Zb(3);return n.passen[a.tabletSession.satzNr-1].ringzahlPfeil1=e})),w.Pb(),w.Qb(1,"input",26),w.Xb("ngModelChange",(function(e){w.pc(t);const n=w.Zb().$implicit;return w.Zb(3).onChange(e,2,n)}))("ngModelChange",(function(e){w.pc(t);const n=w.Zb().$implicit,a=w.Zb(3);return n.passen[a.tabletSession.satzNr-1].ringzahlPfeil2=e})),w.Pb()}if(2&t){const t=w.Zb().$implicit,e=w.Zb(3);w.fc("ngModel",t.passen[e.tabletSession.satzNr-1].ringzahlPfeil1),w.zb(1),w.fc("ngModel",t.passen[e.tabletSession.satzNr-1].ringzahlPfeil2)}}const me=function(t,e){return{"offset-lg-2 offset-xl-3":t,"mb-4":e}};function pe(t,e){if(1&t&&(w.Qb(0,"div",23),w.Qb(1,"div",24),w.Qb(2,"h4"),w.Cc(3),w.Pb(),w.Qb(4,"div",25),w.Ac(5,fe,2,2,"ng-template",2),w.Pb(),w.Pb(),w.Pb()),2&t){const t=e.index,n=e.$implicit,a=w.Zb(3);w.fc("ngClass",w.lc(3,me,0===t,2===t)),w.zb(3),w.Ec("Sch\xfctze ",n.schuetzeNr,""),w.zb(2),w.fc("ngIf",n.passen.length>=a.tabletSession.satzNr)}}function ge(t,e){if(1&t){const t=w.Rb();w.Qb(0,"div",17),w.Qb(1,"h2"),w.Cc(2),w.Pb(),w.Qb(3,"span",7),w.Cc(4,"\u2022"),w.Pb(),w.Qb(5,"h2",18),w.Cc(6),w.ac(7,"translate"),w.Pb(),w.Pb(),w.Ac(8,pe,6,6,"ng-template",11),w.Qb(9,"div",19),w.Qb(10,"button",20),w.Xb("click",(function(){return w.pc(t),w.Zb(2).nextMatch()})),w.Cc(11),w.ac(12,"translate"),w.Mb(13,"i",21),w.Pb(),w.Qb(14,"button",22),w.Xb("click",(function(){return w.pc(t),w.Zb(2).nextSatz()})),w.Cc(15),w.ac(16,"translate"),w.Mb(17,"i",21),w.Pb(),w.Pb()}if(2&t){const t=w.Zb(2);w.zb(2),w.Dc(t.currentMatch.mannschaftName),w.zb(4),w.Fc("",w.bc(7,7,"WKDURCHFUEHRUNG.TABLET_INPUT.SATZ")," ",t.tabletSession.satzNr,""),w.zb(2),w.fc("ngForOf",t.schuetzen),w.zb(3),w.Ec(" ",w.bc(12,9,"WKDURCHFUEHRUNG.TABLET_INPUT.NEXT_MATCH")," "),w.zb(3),w.fc("disabled",!t.allPasseFilled()),w.zb(1),w.Ec(" ",w.bc(16,11,"WKDURCHFUEHRUNG.TABLET_INPUT.NEXT_SET")," ")}}function Se(t,e){if(1&t&&(w.Qb(0,"div",3),w.Qb(1,"h1",4),w.Cc(2),w.ac(3,"translate"),w.Pb(),w.Pb(),w.Qb(4,"div",5),w.Qb(5,"h3",6),w.Cc(6),w.ac(7,"translate"),w.Pb(),w.Qb(8,"span",7),w.Cc(9,"\u2022"),w.Pb(),w.Qb(10,"h3",6),w.Cc(11),w.ac(12,"translate"),w.Pb(),w.Qb(13,"span",7),w.Cc(14,"\u2022"),w.Pb(),w.Qb(15,"h3",6),w.Cc(16),w.Pb(),w.Pb(),w.Qb(17,"div",3),w.Mb(18,"hr"),w.Pb(),w.Ac(19,be,11,8,"ng-template",2),w.Ac(20,ge,18,13,"ng-template",2)),2&t){const t=w.Zb();w.zb(2),w.Fc("",w.bc(3,10,"WKDURCHFUEHRUNG.TABLET_INPUT.SCHEIBE")," ",t.tabletSession.scheibenNr,""),w.zb(4),w.Fc("",w.bc(7,12,"WKDURCHFUEHRUNG.TABLET_INPUT.WETTKAMPFTAG")," ",t.match1.wettkampfTag,""),w.zb(5),w.Fc("",w.bc(12,14,"WKDURCHFUEHRUNG.TABLET_INPUT.MATCH")," ",t.match1.nr,""),w.zb(5),w.Fc("",t.match1.mannschaftName," vs. ",t.match2.mannschaftName,""),w.zb(3),w.fc("ngIf",!t.hasSchuetzenNummern()),w.zb(1),w.fc("ngIf",t.hasSchuetzenNummern())}}function Ee(t,e){if(1&t&&(w.Qb(0,"div",27),w.Qb(1,"div",28),w.Cc(2),w.ac(3,"translate"),w.Qb(4,"a",29),w.Cc(5),w.ac(6,"translate"),w.Pb(),w.Cc(7,". "),w.Pb(),w.Pb()),2&t){const t=w.Zb();w.zb(2),w.Ec(" ",w.bc(3,3,"WKDURCHFUEHRUNG.TABLET_INPUT.CONFIGURE_PART1")," "),w.zb(2),w.gc("routerLink",t.tabletAdminRoute),w.zb(1),w.Dc(w.bc(6,5,"WKDURCHFUEHRUNG.TABLET_INPUT.CONFIGURE_PART2"))}}class Ce{constructor(t){this.passen=[],this.addPasse(),this.schuetzeNr=Number.isNaN(t)?null:t}addPasse(){const t=new U;t.lfdNr=this.passen.length+1,t.rueckennummer=this.schuetzeNr,this.passen.push(t)}}const Te=new T(null,null,null,1,1,1,1,[],1,1,null,null);let Pe=(()=>{class t{constructor(t,e,n,a,i,s,c){this.schusszettelService=t,this.passeService=e,this.matchService=n,this.tabletSessionService=a,this.route=i,this.router=s,this.notificationService=c}static getSchuetzeIdxValues(){return Array.apply(null,{length:3}).map(Number.call,Number)}ngOnInit(){this.match1=Te,this.match2=Te,this.currentMatch=Te,this.route.params.subscribe(t=>{Object(E.c)(t.match1id)||Object(E.c)(t.match2id)||this.schusszettelService.findMatches(t.match1id,t.match2id).then(t=>{this.match1=t.payload[0],this.match2=t.payload[1],this.tabletAdminRoute="/schusszettel/tabletadmin/"+this.match1.wettkampfId,this.initStorageData(),this.tabletSession&&(this.currentMatch=this.match2.scheibenNummer===this.tabletSession.scheibenNr?this.match2:this.match1,this.initExistingPassen()),this.tabletSession.matchID=this.currentMatch&&this.currentMatch.id?this.currentMatch.id:this.tabletSession.matchID,this.updateTabletSession(),this.dumpStorageData()},t=>{console.error(t)})})}initStorageData(){const t=Number.parseInt(localStorage.getItem("submittedSchuetzenNr"),10);try{this.tabletSession=JSON.parse(localStorage.getItem("tabletSession")),this.tabletSession.satzNr||(this.tabletSession.satzNr=1,this.updateTabletSession())}catch(e){this.notificationService.observeNotification("tabletSessionMissing").subscribe(t=>{t.userAction===R.h.ACCEPTED&&this.router.navigate([this.tabletAdminRoute])}),this.resetStorageData(),this.showMissingTabletSessionNotification()}this.submittedSchuetzenNr=!(!Boolean(t)||isNaN(t))&&1===t,this.initSchuetzen()}initSchuetzen(){const e=localStorage.getItem("schuetzen"),n=Boolean(e)?JSON.parse(e):[];if(this.schuetzen=[],0===n.length)for(const a of t.getSchuetzeIdxValues()){const t=Number.parseInt(localStorage.getItem("schuetze"+(a+1)),10);this.schuetzen.push(new Ce(t))}else for(const t of n){const e=new Ce(Number(t.schuetzeNr));e.passen=[];for(const n of t.passen){const t=new U;for(const e of Object.keys(n))t[e]=n[e];e.passen.push(t)}this.schuetzen.push(e)}}dumpStorageData(){if(localStorage.setItem("tabletSession",JSON.stringify(this.tabletSession)),localStorage.setItem("submittedSchuetzenNr",this.submittedSchuetzenNr?Number(1).toString():Number(0).toString()),localStorage.setItem("schuetzen",Boolean(this.schuetzen)?JSON.stringify(this.schuetzen):""),this.hasSchuetzenNummern())for(const e of t.getSchuetzeIdxValues())localStorage.setItem("schuetze"+(e+1),this.schuetzen[e].schuetzeNr.toString())}resetStorageData(){localStorage.setItem("submittedSchuetzenNr","0"),localStorage.setItem("schuetzen","");for(const e of t.getSchuetzeIdxValues())localStorage.setItem("schuetze"+(e+1),"");this.schuetzen=[],this.submittedSchuetzenNr=!1}initExistingPassen(){let t=0;for(const e of this.currentMatch.schuetzen){if(e.length>0)for(this.schuetzen[t].passen=e;this.schuetzen[t].passen.length<this.tabletSession.satzNr;)this.schuetzen[t].addPasse();t++}this.dumpStorageData()}submitSchuetzenNr(){this.hasValidSchuetzenNr()&&(this.submittedSchuetzenNr=!0,this.dumpStorageData())}hasValidSchuetzenNr(){return Boolean(this.schuetzen)&&null!==this.schuetzen[0].schuetzeNr&&null!==this.schuetzen[1].schuetzeNr&&null!==this.schuetzen[2].schuetzeNr&&this.schuetzen[0].schuetzeNr>0&&this.schuetzen[1].schuetzeNr>0&&this.schuetzen[2].schuetzeNr>0}hasSchuetzenNummern(){return this.hasValidSchuetzenNr()&&this.submittedSchuetzenNr}onChange(t,e,n){const a=n.passen[this.tabletSession.satzNr-1];a["ringzahlPfeil"+e]=t,this.passeIsValid(a)&&(this.enrichPasseDO(a,n),this.createOrUpdatePasse(a,n))}createOrUpdatePasse(t,e){null!==t.id?this.passeService.update(t).then(t=>{e.passen[this.tabletSession.satzNr-1]=t.payload,this.dumpStorageData()}).catch(t=>{console.error(t)}):this.passeService.create(t).then(t=>{e.passen[this.tabletSession.satzNr-1]=t.payload,this.dumpStorageData()}).catch(t=>{console.error(t)})}nextSatz(){this.allPasseFilled()&&(this.addEmptyPassen(),this.tabletSession.satzNr++,this.updateTabletSession(),this.dumpStorageData())}addEmptyPassen(){for(const t of this.schuetzen)t.addPasse()}allPasseFilled(){let t=!0;for(const e of this.schuetzen)t=t&&this.passeIsValid(e.passen[this.tabletSession.satzNr-1]);return t}nextMatch(){this.showConfirmNextMatchNotification(),this.notificationService.observeNotification("tabletEingabeConfirmNextMatch").subscribe(t=>{t.userAction===R.h.ACCEPTED&&(this.showNextMatchNotification(),this.matchService.next(this.currentMatch.id).then(t=>{2===t.payload.length&&(this.resetStorageData(),this.initStorageData(),this.router.navigate(["/schusszettel/"+t.payload[0]+"/"+t.payload[1]+"/tablet"]),this.notificationService.discardNotification())}))})}updateTabletSession(){this.tabletSession&&this.tabletSessionService.update(this.tabletSession).then(t=>{this.tabletSession=t.payload,this.dumpStorageData()})}showMissingTabletSessionNotification(){this.notificationService.showNotification({id:"tabletSessionMissing",title:"Konfigurationsfehler",description:"Dieses Ger\xe4t wurde noch f\xfcr keine Scheibe registriert. Bitte holen Sie dies in der Ligatabelle-Administration nach.",severity:R.f.ERROR,origin:R.d.SYSTEM,type:R.g.OK,userAction:R.h.PENDING})}showConfirmNextMatchNotification(){this.notificationService.showNotification({id:"tabletEingabeConfirmNextMatch",title:"N\xe4chstes Match starten",description:"Wollen Sie wirklich das n\xe4chste Match starten?",severity:R.f.QUESTION,origin:R.d.SYSTEM,type:R.g.YES_NO,userAction:R.h.PENDING})}showNextMatchNotification(){this.notificationService.showNotification({id:"tabletEingabeNextMatch",title:"L\xe4dt ...",description:"Das n\xe4chste anstehende Match auf dieser Scheibe wird geladen...",severity:R.f.INFO,origin:R.d.USER,type:R.g.OK,userAction:R.h.PENDING})}passeIsValid(t){return!!t&&t.ringzahlPfeil1&&t.ringzahlPfeil1>=0&&t.ringzahlPfeil2&&t.ringzahlPfeil2>=0}enrichPasseDO(t,e){t.mannschaftId=this.currentMatch.mannschaftId,t.matchNr=this.currentMatch.nr,t.matchId=this.currentMatch.id,t.wettkampfId=this.currentMatch.wettkampfId,t.rueckennummer=e.schuetzeNr}}return t.\u0275fac=function(e){return new(e||t)(w.Lb(It),w.Lb(ne),w.Lb(H),w.Lb(ie.a),w.Lb(s.a),w.Lb(s.c),w.Lb(R.e))},t.\u0275cmp=w.Fb({type:t,selectors:[["bla-tableteingabe"]],decls:4,vars:2,consts:[[1,"tablet-eingabe"],[1,"row"],[3,"ngIf"],[1,"col-sm-12"],[1,"w-100","text-center","my-3"],[1,"col-sm-12","tablet-eingabe-info-section"],[1,"text-center","d-inline-block"],[1,"mx-3","separator"],[1,"w-100","text-center","d-inline-block"],[1,"offset-lg-3","col-lg-6","offset-xl-4","col-xl-4"],[1,"pb-5","pt-3","w-100","flex-container","justify-content-around"],["ngFor","",3,"ngForOf"],[1,"offset-4","col-sm-4","justify-content-end","flex-container"],[1,"btn","btn-primary","mb-5",3,"disabled","click"],[1,"d-inline-flex","align-items-center","flex-column"],[1,"h4",3,"for"],["blaMyNumberOnly","","type","number",3,"ngModel","id","tabindex","ngModelChange"],[1,"col-sm-12","tablet-eingabe-current"],[1,"mb-3"],[1,"offset-2","col-sm-8","justify-content-between","flex-container"],[1,"btn","btn-primary","mr-3","my-5",3,"click"],[1,"fa","fa-fw","fa-chevron-right"],[1,"btn","btn-primary","mr-3","my-5",3,"disabled","click"],[1,"col-lg-3","col-xl-2",3,"ngClass"],[1,"schuetze"],[1,"flex-container"],["blaMyNumberOnly","","type","text",1,"m-2",3,"ngModel","ngModelChange"],[1,"col-sm-12","justify-content-around"],[1,"alert","alert-warning","m-3"],[3,"routerLink"]],template:function(t,e){1&t&&(w.Qb(0,"div",0),w.Qb(1,"div",1),w.Ac(2,Se,21,16,"ng-template",2),w.Ac(3,Ee,8,7,"ng-template",2),w.Pb(),w.Pb()),2&t&&(w.zb(2),w.fc("ngIf",e.tabletSession),w.zb(1),w.fc("ngIf",!e.tabletSession))},directives:[a.t,a.s,i.t,i.c,i.n,i.q,a.q,s.f],pipes:[St.d],styles:[".tablet-eingabe[_ngcontent-%COMP%]   .tablet-eingabe-info-section[_ngcontent-%COMP%]{text-align:center}.tablet-eingabe[_ngcontent-%COMP%]   .tablet-eingabe-info-section[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{font-size:1.75rem}.tablet-eingabe[_ngcontent-%COMP%]   .tablet-eingabe-current[_ngcontent-%COMP%]{text-align:center}.tablet-eingabe[_ngcontent-%COMP%]   .tablet-eingabe-current[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{font-size:2rem}input[_ngcontent-%COMP%], label[_ngcontent-%COMP%]{display:block}input[_ngcontent-%COMP%]::-webkit-inner-spin-button, input[_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[_ngcontent-%COMP%]{height:55px;width:55px;-moz-appearance:textfield;font-size:30px;text-align:center}input[_ngcontent-%COMP%]:focus{box-shadow:0 0 8px 0 #057aff}.flex-container[_ngcontent-%COMP%]{display:flex}"]}),t})();var Ue=n("th7h");let Ne=(()=>{class t{constructor(t){this.currentUserService=t}canActivate(){return this.currentUserService.hasAnyPermisson([Ue.b.CAN_READ_WETTKAMPF,Ue.b.CAN_MODIFY_WETTKAMPF])}}return t.\u0275fac=function(e){return new(e||t)(w.Ub(Ue.a))},t.\u0275prov=w.Hb({token:t,factory:t.\u0275fac}),t})();const Ie=[{path:"",pathMatch:"full",component:Nt,canActivate:[Ne]},{path:"",pathMatch:"full",component:ee},{path:"",pathMatch:"full",component:Pe},{path:"",pathMatch:"full",component:ue},{path:":wettkampfId",pathMatch:"full",component:Nt},{path:"tabletadmin/:wettkampfId",pathMatch:"full",component:ue},{path:"schusszettel/:match1id/:match2id",pathMatch:"full",component:ee},{path:":match1id/:match2id/tablet",pathMatch:"full",component:Pe}];let ze=(()=>{class t{constructor(t){this.currentUserService=t}canActivate(t,e){return this.currentUserService.hasPermission(R.j.CAN_READ_MY_VERANSTALTUNG)}}return t.\u0275fac=function(e){return new(e||t)(w.Ub(R.a))},t.\u0275prov=w.Hb({token:t,factory:t.\u0275fac}),t})(),Re=(()=>{class t{constructor(t){this.currentUserService=t}canActivate(t,e){return this.currentUserService.hasPermission(R.j.CAN_OPERATE_SPOTTING)}}return t.\u0275fac=function(e){return new(e||t)(w.Ub(R.a))},t.\u0275prov=w.Hb({token:t,factory:t.\u0275fac}),t})(),ke=(()=>{class t{constructor(t){this.currentUserService=t}canActivate(t,e){return this.currentUserService.hasAnyPermisson([R.j.CAN_MODIFY_MY_VERANSTALTUNG,R.j.CAN_OPERATE_SPOTTING])}}return t.\u0275fac=function(e){return new(e||t)(w.Ub(R.a))},t.\u0275prov=w.Hb({token:t,factory:t.\u0275fac}),t})(),ve=(()=>{class t{static forRoot(){return{ngModule:c.a,providers:[Ne,ze,Re,ke]}}}return t.\u0275mod=w.Jb({type:t}),t.\u0275inj=w.Ib({factory:function(e){return new(e||t)},providers:[Ne,ze,Re,ke],imports:[[a.c,s.g.forChild(Ie),c.a.forChild(),i.k]]}),t})()}}]);